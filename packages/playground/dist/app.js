(()=>{var Un=Object.create;var qt=Object.defineProperty;var zn=Object.getOwnPropertyDescriptor;var Vn=Object.getOwnPropertyNames;var Hn=Object.getPrototypeOf,Qn=Object.prototype.hasOwnProperty;var X=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Kn=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Vn(e))!Qn.call(t,s)&&s!==n&&qt(t,s,{get:()=>e[s],enumerable:!(r=zn(e,s))||r.enumerable});return t};var Bt=(t,e,n)=>(n=t!=null?Un(Hn(t)):{},Kn(e||!t||!t.__esModule?qt(n,"default",{value:t,enumerable:!0}):n,t));var _n=X(te=>{"use strict";Object.defineProperty(te,"__esModule",{value:!0});function j(t){let e=t||"";return function(){throw new Error("this method "+e+" is abstract! (it has no implementation in class "+this.constructor.name+")")}}function ce(t,e){if(!t)throw new Error(e||"Assertion failed")}function lt(t,e,n){let r;Object.defineProperty(t,e,{get(){return r||(r=n.call(this)),r}})}function Wn(t){return t&&Object.assign({},t)}function en(t,e){let n=[];for(;e-- >0;)n.push(t());return n}function tn(t,e){return new Array(e+1).join(t)}function ze(t,e){return en(()=>t,e)}function ct(t){let e=[];for(let n=0;n<t.length;n++){let r=t[n];t.lastIndexOf(r)!==n&&e.indexOf(r)<0&&e.push(r)}return e}function nn(t){let e=[];return t.forEach(n=>{e.indexOf(n)<0&&e.push(n)}),e}function pe(t){let e=t[0];return e===e.toUpperCase()}function rn(t){return!pe(t)}function sn(t,e,n){let r=n||" ";return t.length<e?tn(r,e-t.length)+t:t}function ge(){this.strings=[]}ge.prototype.append=function(t){this.strings.push(t)};ge.prototype.contents=function(){return this.strings.join("")};var it=t=>String.fromCodePoint(parseInt(t,16));function an(t){if(t.charAt(0)==="\\")switch(t.charAt(1)){case"b":return"\b";case"f":return"\f";case"n":return`
`;case"r":return"\r";case"t":return"	";case"v":return"\v";case"x":return it(t.slice(2,4));case"u":return t.charAt(2)==="{"?it(t.slice(3,-1)):it(t.slice(2,6));default:return t.charAt(1)}else return t}function bt(t){if(t==null)return String(t);let e=Object.prototype.toString.call(t);try{let n;return t.constructor&&t.constructor.name?n=t.constructor.name:e.indexOf("[object ")===0?n=e.slice(8,-1):n=typeof t,n+": "+JSON.stringify(String(t))}catch{return e}}function on(t,e="unexpected null value"){if(t==null)throw new Error(e);return t}var Zn=Object.freeze({__proto__:null,abstract:j,assert:ce,defineLazyProperty:lt,clone:Wn,repeatFn:en,repeatStr:tn,repeat:ze,getDuplicates:ct,copyWithoutDuplicates:nn,isSyntactic:pe,isLexical:rn,padLeft:sn,StringBuffer:ge,unescapeCodePoint:an,unexpectedObjToString:bt,checkNotNull:on}),ln=t=>new RegExp(String.raw`\p{${t}}`,"u"),ut=Object.fromEntries(["Cc","Cf","Cn","Co","Cs","Ll","Lm","Lo","Lt","Lu","Mc","Me","Mn","Nd","Nl","No","Pc","Pd","Pe","Pf","Pi","Po","Ps","Sc","Sk","Sm","So","Zl","Zp","Zs"].map(t=>[t,ln(t)]));ut.Ltmo=/\p{Lt}|\p{Lm}|\p{Lo}/u;var Gt=Object.fromEntries(["XID_Start","XID_Continue","White_Space"].map(t=>[t,ln(t)])),I=class t{constructor(){if(this.constructor===t)throw new Error("PExpr cannot be instantiated -- it's abstract")}withSource(e){return e&&(this.source=e.trimmed()),this}},F=Object.create(I.prototype),D=Object.create(I.prototype),L=class extends I{constructor(e){super(),this.obj=e}},T=class extends I{constructor(e,n){super(),this.from=e,this.to=n,this.matchCodePoint=e.length>1||n.length>1}},R=class extends I{constructor(e){super(),this.index=e}},S=class extends I{constructor(e){super(),this.terms=e}},he=class extends S{constructor(e,n,r){let s=e.rules[n].body;super([r,s]),this.superGrammar=e,this.name=n,this.body=r}},de=class extends S{constructor(e,n,r,s){let i=e.rules[n].body;super([...r,i,...s]),this.superGrammar=e,this.ruleName=n,this.expansionPos=r.length}},O=class extends I{constructor(e){super(),this.factors=e}},k=class extends I{constructor(e){super(),this.expr=e}},ee=class extends k{},ie=class extends k{},Q=class extends k{};ee.prototype.operator="*";ie.prototype.operator="+";Q.prototype.operator="?";ee.prototype.minNumMatches=0;ie.prototype.minNumMatches=1;Q.prototype.minNumMatches=0;ee.prototype.maxNumMatches=Number.POSITIVE_INFINITY;ie.prototype.maxNumMatches=Number.POSITIVE_INFINITY;Q.prototype.maxNumMatches=1;var P=class extends I{constructor(e){super(),this.expr=e}},$=class extends I{constructor(e){super(),this.expr=e}},M=class extends I{constructor(e){super(),this.expr=e}},b=class extends I{constructor(e,n=[]){super(),this.ruleName=e,this.args=n}isSyntactic(){return pe(this.ruleName)}toMemoKey(){return this._memoKey||Object.defineProperty(this,"_memoKey",{value:this.toString()}),this._memoKey}},C=class extends I{constructor(e){if(super(),this.categoryOrProp=e,e in ut)this.pattern=ut[e];else if(e in Gt)this.pattern=Gt[e];else throw new Error(`Invalid Unicode category or property name: ${JSON.stringify(e)}`)}};function w(t,e){let n;return e?(n=new Error(e.getLineAndColumnMessage()+t),n.shortMessage=t,n.interval=e):n=new Error(t),n}function pt(){return w("Interval sources don't match")}function Jn(t){let e=new Error;return Object.defineProperty(e,"message",{enumerable:!0,get(){return t.message}}),Object.defineProperty(e,"shortMessage",{enumerable:!0,get(){return"Expected "+t.getExpectedText()}}),e.interval=t.getInterval(),e}function Yn(t,e,n){let r=e?`Grammar ${t} is not declared in namespace '${e}'`:"Undeclared grammar "+t;return w(r,n)}function Xn(t,e){return w("Grammar "+t.name+" is already declared in this namespace")}function er(t){return w(`Grammar '${t.name}' does not support incremental parsing`)}function cn(t,e,n){return w("Rule "+t+" is not declared in grammar "+e,n)}function tr(t,e,n){return w("Cannot override rule "+t+" because it is not declared in "+e,n)}function nr(t,e,n){return w("Cannot extend rule "+t+" because it is not declared in "+e,n)}function Ut(t,e,n,r){let s="Duplicate declaration for rule '"+t+"' in grammar '"+e+"'";return e!==n&&(s+=" (originally declared in '"+n+"')"),w(s,r)}function un(t,e,n,r){return w("Wrong number of parameters for rule "+t+" (expected "+e+", got "+n+")",r)}function rr(t,e,n,r){return w("Wrong number of arguments for rule "+t+" (expected "+e+", got "+n+")",r)}function zt(t,e,n){return w("Duplicate parameter names in rule "+t+": "+e.join(", "),n)}function sr(t,e){return w("Invalid parameter to rule "+t+": "+e+" has arity "+e.getArity()+", but parameter expressions must have arity 1",e.source)}var ir="NOTE: A _syntactic rule_ is a rule whose name begins with a capital letter. See https://ohmjs.org/d/svl for more details.";function ar(t,e){return w("Cannot apply syntactic rule "+t+" from here (inside a lexical context)",e.source)}function or(t){let{ruleName:e}=t;return w(`applySyntactic is for syntactic rules, but '${e}' is a lexical rule. `+ir,t.source)}function lr(t){return w("applySyntactic is not required here (in a syntactic context)",t.source)}function Vt(t,e){return w("Incorrect argument type: expected "+t,e.source)}function cr(t){return w("'...' can appear at most once in a rule body",t.source)}function ur(t){let e=t._node;ce(e&&e.isNonterminal()&&e.ctorName==="escapeChar_unicodeCodePoint");let n=t.children.slice(1,-1).map(s=>s.source),r=n[0].coverageWith(...n.slice(1));return w(`U+${r.contents} is not a valid Unicode code point`,r)}function pn(t,e){let n=e.length>0?e[e.length-1].args:[],s="Nullable expression "+t.expr.substituteParams(n)+" is not allowed inside '"+t.operator+"' (possible infinite loop)";if(e.length>0){let i=e.map(a=>new b(a.ruleName,a.args)).join(`
`);s+=`
Application stack (most recent application last):
`+i}return w(s,t.expr.source)}function hn(t,e,n,r){return w("Rule "+t+" involves an alternation which has inconsistent arity (expected "+e+", got "+n+")",r.source)}function pr(t){let e=t.map(n=>n.message);return w(["Errors:"].concat(e).join(`
- `),t[0].interval)}function hr(t,e,n,r){let s=r.slice(0,-1).map(o=>{let d="  "+o[0].name+" > "+o[1];return o.length===3?d+" for '"+o[2]+"'":d}).join(`
`);s+=`
  `+e+" > "+t;let i="";t==="_iter"&&(i=[`
NOTE: as of Ohm v16, there is no default action for iteration nodes \u2014 see `,"  https://ohmjs.org/d/dsa for details."].join(`
`));let a=[`Missing semantic action for '${t}' in ${n} '${e}'.${i}`,"Action stack (most recent call last):",s].join(`
`),l=w(a);return l.name="missingSemanticAction",l}function dr(t){if(t.length===1)throw t[0];if(t.length>1)throw pr(t)}function fr(t){let e=0;return t.map(r=>{let s=r.toString();return e=Math.max(e,s.length),s}).map(r=>sn(r,e))}function Ht(t,e,n){let r=t.length,s=t.slice(0,n),i=t.slice(n+e.length);return(s+e+i).substr(0,r)}function mr(...t){let e=this,{offset:n}=e,{repeatStr:r}=Zn,s=new ge;s.append("Line "+e.lineNum+", col "+e.colNum+`:
`);let i=fr([e.prevLine==null?0:e.lineNum-1,e.lineNum,e.nextLine==null?0:e.lineNum+1]),a=(c,u,p)=>{s.append(p+i[c]+" | "+u+`
`)};e.prevLine!=null&&a(0,e.prevLine,"  "),a(1,e.line,"> ");let l=e.line.length,o=r(" ",l+1);for(let c=0;c<t.length;++c){let u=t[c][0],p=t[c][1];ce(u>=0&&u<=p,"range start must be >= 0 and <= end");let h=n-e.colNum+1;u=Math.max(0,u-h),p=Math.min(p-h,l),o=Ht(o,r("~",p-u),u)}let d=2+i[1].length+3;return s.append(r(" ",d)),o=Ht(o,"^",e.colNum-1),s.append(o.replace(/ +$/,"")+`
`),e.nextLine!=null&&a(2,e.nextLine,"  "),s.contents()}var ht=[];function dn(t){ht.push(t)}function gr(t){ht.forEach(e=>{e(t)}),ht=null}function xt(t,e){let n=1,r=1,s=0,i=0,a=null,l=null,o=-1;for(;s<e;){let u=t.charAt(s++);u===`
`?(n++,r=1,o=i,i=s):u!=="\r"&&r++}let d=t.indexOf(`
`,i);if(d===-1)d=t.length;else{let u=t.indexOf(`
`,d+1);a=u===-1?t.slice(d):t.slice(d,u),a=a.replace(/^\r?\n/,"").replace(/\r$/,"")}o>=0&&(l=t.slice(o,i).replace(/\r?\n$/,""));let c=t.slice(i,d).replace(/\r$/,"");return{offset:e,lineNum:n,colNum:r,line:c,prevLine:l,nextLine:a,toString:mr}}function _t(t,e,...n){return xt(t,e).toString(...n)}var Qt=(()=>{let t=0;return e=>""+e+t++})(),fe=class t{constructor(e,n,r){Object.defineProperty(this,"_sourceString",{value:e,configurable:!1,enumerable:!1,writable:!1}),this.startIdx=n,this.endIdx=r}get sourceString(){return this._sourceString}get contents(){return this._contents===void 0&&(this._contents=this.sourceString.slice(this.startIdx,this.endIdx)),this._contents}get length(){return this.endIdx-this.startIdx}coverageWith(...e){return t.coverage(...e,this)}collapsedLeft(){return new t(this.sourceString,this.startIdx,this.startIdx)}collapsedRight(){return new t(this.sourceString,this.endIdx,this.endIdx)}getLineAndColumn(){return xt(this.sourceString,this.startIdx)}getLineAndColumnMessage(){let e=[this.startIdx,this.endIdx];return _t(this.sourceString,this.startIdx,e)}minus(e){if(this.sourceString!==e.sourceString)throw pt();return this.startIdx===e.startIdx&&this.endIdx===e.endIdx?[]:this.startIdx<e.startIdx&&e.endIdx<this.endIdx?[new t(this.sourceString,this.startIdx,e.startIdx),new t(this.sourceString,e.endIdx,this.endIdx)]:this.startIdx<e.endIdx&&e.endIdx<this.endIdx?[new t(this.sourceString,e.endIdx,this.endIdx)]:this.startIdx<e.startIdx&&e.startIdx<this.endIdx?[new t(this.sourceString,this.startIdx,e.startIdx)]:[this]}relativeTo(e){if(this.sourceString!==e.sourceString)throw pt();return ce(this.startIdx>=e.startIdx&&this.endIdx<=e.endIdx,"other interval does not cover this one"),new t(this.sourceString,this.startIdx-e.startIdx,this.endIdx-e.startIdx)}trimmed(){let{contents:e}=this,n=this.startIdx+e.match(/^\s*/)[0].length,r=this.endIdx-e.match(/\s*$/)[0].length;return new t(this.sourceString,n,r)}subInterval(e,n){let r=this.startIdx+e;return new t(this.sourceString,r,r+n)}};fe.coverage=function(t,...e){let{startIdx:n,endIdx:r}=t;for(let s of e){if(s.sourceString!==t.sourceString)throw pt();n=Math.min(n,s.startIdx),r=Math.max(r,s.endIdx)}return new fe(t.sourceString,n,r)};var yr=65535,vr=1114111,be=class{constructor(e){this.source=e,this.pos=0,this.examinedLength=0}atEnd(){let e=this.pos>=this.source.length;return this.examinedLength=Math.max(this.examinedLength,this.pos+1),e}next(){let e=this.source[this.pos++];return this.examinedLength=Math.max(this.examinedLength,this.pos),e}nextCharCode(){let e=this.next();return e&&e.charCodeAt(0)}nextCodePoint(){let e=this.source.slice(this.pos++).codePointAt(0);return e>yr&&(this.pos+=1),this.examinedLength=Math.max(this.examinedLength,this.pos),e}matchString(e,n){let r;if(n){for(r=0;r<e.length;r++){let s=this.next(),i=e[r];if(s==null||s.toUpperCase()!==i.toUpperCase())return!1}return!0}for(r=0;r<e.length;r++)if(this.next()!==e[r])return!1;return!0}sourceSlice(e,n){return this.source.slice(e,n)}interval(e,n){return new fe(this.source,e,n||this.pos)}},Fe=class{constructor(e,n,r,s,i,a,l){this.matcher=e,this.input=n,this.startExpr=r,this._cst=s,this._cstOffset=i,this._rightmostFailurePosition=a,this._rightmostFailures=l,this.failed()&&(lt(this,"message",function(){let o="Expected "+this.getExpectedText();return _t(this.input,this.getRightmostFailurePosition())+o}),lt(this,"shortMessage",function(){let o="expected "+this.getExpectedText(),d=xt(this.input,this.getRightmostFailurePosition());return"Line "+d.lineNum+", col "+d.colNum+": "+o}))}succeeded(){return!!this._cst}failed(){return!this.succeeded()}getRightmostFailurePosition(){return this._rightmostFailurePosition}getRightmostFailures(){if(!this._rightmostFailures){this.matcher.setInput(this.input);let e=this.matcher._match(this.startExpr,{tracing:!1,positionToRecordFailures:this.getRightmostFailurePosition()});this._rightmostFailures=e.getRightmostFailures()}return this._rightmostFailures}toString(){return this.succeeded()?"[match succeeded]":"[match failed at position "+this.getRightmostFailurePosition()+"]"}getExpectedText(){if(this.succeeded())throw new Error("cannot get expected text of a successful MatchResult");let e=new ge,n=this.getRightmostFailures();n=n.filter(r=>!r.isFluffy());for(let r=0;r<n.length;r++)r>0&&(r===n.length-1?e.append(n.length>2?", or ":" or "):e.append(", ")),e.append(n[r].toString());return e.contents()}getInterval(){let e=this.getRightmostFailurePosition();return new fe(this.input,e,e)}},dt=class{constructor(){this.applicationMemoKeyStack=[],this.memo={},this.maxExaminedLength=0,this.maxRightmostFailureOffset=-1,this.currentLeftRecursion=void 0}isActive(e){return this.applicationMemoKeyStack.indexOf(e.toMemoKey())>=0}enter(e){this.applicationMemoKeyStack.push(e.toMemoKey())}exit(){this.applicationMemoKeyStack.pop()}startLeftRecursion(e,n){n.isLeftRecursion=!0,n.headApplication=e,n.nextLeftRecursion=this.currentLeftRecursion,this.currentLeftRecursion=n;let{applicationMemoKeyStack:r}=this,s=r.indexOf(e.toMemoKey())+1,i=r.slice(s);n.isInvolved=function(a){return i.indexOf(a)>=0},n.updateInvolvedApplicationMemoKeys=function(){for(let a=s;a<r.length;a++){let l=r[a];this.isInvolved(l)||i.push(l)}}}endLeftRecursion(){this.currentLeftRecursion=this.currentLeftRecursion.nextLeftRecursion}shouldUseMemoizedResult(e){if(!e.isLeftRecursion)return!0;let{applicationMemoKeyStack:n}=this;for(let r=0;r<n.length;r++){let s=n[r];if(e.isInvolved(s))return!1}return!0}memoize(e,n){return this.memo[e]=n,this.maxExaminedLength=Math.max(this.maxExaminedLength,n.examinedLength),this.maxRightmostFailureOffset=Math.max(this.maxRightmostFailureOffset,n.rightmostFailureOffset),n}clearObsoleteEntries(e,n){if(e+this.maxExaminedLength<=n)return;let{memo:r}=this;this.maxExaminedLength=0,this.maxRightmostFailureOffset=-1,Object.keys(r).forEach(s=>{let i=r[s];e+i.examinedLength>n?delete r[s]:(this.maxExaminedLength=Math.max(this.maxExaminedLength,i.examinedLength),this.maxRightmostFailureOffset=Math.max(this.maxRightmostFailureOffset,i.rightmostFailureOffset))})}},Ir="\u2717",br="\u2713",xr="\u22C5",_r="\u21D2",Sr="\u2409",wr="\u240A",Ar="\u240D",ft={succeeded:1,isRootNode:2,isImplicitSpaces:4,isMemoized:8,isHeadOfLeftRecursion:16,terminatesLR:32};function Er(t){return ze(" ",t).join("")}function Or(t,e,n){let r=fn(t.slice(e,e+n));return r.length<n?r+ze(" ",n-r.length).join(""):r}function fn(t){return typeof t=="string"?t.replace(/ /g,xr).replace(/\t/g,Sr).replace(/\n/g,wr).replace(/\r/g,Ar):String(t)}var xe=class t{constructor(e,n,r,s,i,a,l){this.input=e,this.pos=this.pos1=n,this.pos2=r,this.source=new fe(e,n,r),this.expr=s,this.bindings=a,this.children=l||[],this.terminatingLREntry=null,this._flags=i?ft.succeeded:0}get displayString(){return this.expr.toDisplayString()}clone(){return this.cloneWithExpr(this.expr)}cloneWithExpr(e){let n=new t(this.input,this.pos,this.pos2,e,this.succeeded,this.bindings,this.children);return n.isHeadOfLeftRecursion=this.isHeadOfLeftRecursion,n.isImplicitSpaces=this.isImplicitSpaces,n.isMemoized=this.isMemoized,n.isRootNode=this.isRootNode,n.terminatesLR=this.terminatesLR,n.terminatingLREntry=this.terminatingLREntry,n}recordLRTermination(e,n){this.terminatingLREntry=new t(this.input,this.pos,this.pos2,this.expr,!1,[n],[e]),this.terminatingLREntry.terminatesLR=!0}walk(e,n){let r=e;typeof r=="function"&&(r={enter:r});function s(i,a,l){let o=!0;r.enter&&r.enter.call(n,i,a,l)===t.prototype.SKIP&&(o=!1),o&&(i.children.forEach(d=>{s(d,i,l+1)}),r.exit&&r.exit.call(n,i,a,l))}this.isRootNode?this.children.forEach(i=>{s(i,null,0)}):s(this,null,0)}toString(){let e=new ge;return this.walk((n,r,s)=>{if(!n)return this.SKIP;if(n.expr.constructor.name!=="Alt"){if(e.append(Or(n.input,n.pos,10)+Er(s*2+1)),e.append((n.succeeded?br:Ir)+" "+n.displayString),n.isHeadOfLeftRecursion&&e.append(" (LR)"),n.succeeded){let a=fn(n.source.contents);e.append(" "+_r+"  "),e.append(typeof a=="string"?'"'+a+'"':a)}e.append(`
`)}}),e.contents()}};xe.prototype.SKIP={};Object.keys(ft).forEach(t=>{let e=ft[t];Object.defineProperty(xe.prototype,t,{get(){return(this._flags&e)!==0},set(n){n?this._flags|=e:this._flags&=~e}})});I.prototype.allowsSkippingPrecedingSpace=j("allowsSkippingPrecedingSpace");F.allowsSkippingPrecedingSpace=D.allowsSkippingPrecedingSpace=b.prototype.allowsSkippingPrecedingSpace=L.prototype.allowsSkippingPrecedingSpace=T.prototype.allowsSkippingPrecedingSpace=C.prototype.allowsSkippingPrecedingSpace=function(){return!0};S.prototype.allowsSkippingPrecedingSpace=k.prototype.allowsSkippingPrecedingSpace=M.prototype.allowsSkippingPrecedingSpace=$.prototype.allowsSkippingPrecedingSpace=P.prototype.allowsSkippingPrecedingSpace=R.prototype.allowsSkippingPrecedingSpace=O.prototype.allowsSkippingPrecedingSpace=function(){return!1};var Ne;dn(t=>{Ne=t});var De;I.prototype.assertAllApplicationsAreValid=function(t,e){De=0,this._assertAllApplicationsAreValid(t,e)};I.prototype._assertAllApplicationsAreValid=j("_assertAllApplicationsAreValid");F._assertAllApplicationsAreValid=D._assertAllApplicationsAreValid=L.prototype._assertAllApplicationsAreValid=T.prototype._assertAllApplicationsAreValid=R.prototype._assertAllApplicationsAreValid=C.prototype._assertAllApplicationsAreValid=function(t,e){};M.prototype._assertAllApplicationsAreValid=function(t,e){De++,this.expr._assertAllApplicationsAreValid(t,e),De--};S.prototype._assertAllApplicationsAreValid=function(t,e){for(let n=0;n<this.terms.length;n++)this.terms[n]._assertAllApplicationsAreValid(t,e)};O.prototype._assertAllApplicationsAreValid=function(t,e){for(let n=0;n<this.factors.length;n++)this.factors[n]._assertAllApplicationsAreValid(t,e)};k.prototype._assertAllApplicationsAreValid=P.prototype._assertAllApplicationsAreValid=$.prototype._assertAllApplicationsAreValid=function(t,e){this.expr._assertAllApplicationsAreValid(t,e)};b.prototype._assertAllApplicationsAreValid=function(t,e,n=!1){let r=e.rules[this.ruleName],s=pe(t)&&De===0;if(!r)throw cn(this.ruleName,e.name,this.source);if(!n&&pe(this.ruleName)&&!s)throw ar(this.ruleName,this);let i=this.args.length,a=r.formals.length;if(i!==a)throw rr(this.ruleName,a,i,this.source);let l=Ne&&r===Ne.rules.applySyntactic;if(Ne&&r===Ne.rules.caseInsensitive&&!(this.args[0]instanceof L))throw Vt('a Terminal (e.g. "abc")',this.args[0]);if(l){let d=this.args[0];if(!(d instanceof b))throw Vt("a syntactic rule application",d);if(!pe(d.ruleName))throw or(d);if(s)throw lr(this)}this.args.forEach(d=>{if(d._assertAllApplicationsAreValid(t,e,l),d.getArity()!==1)throw sr(this.ruleName,d)})};I.prototype.assertChoicesHaveUniformArity=j("assertChoicesHaveUniformArity");F.assertChoicesHaveUniformArity=D.assertChoicesHaveUniformArity=L.prototype.assertChoicesHaveUniformArity=T.prototype.assertChoicesHaveUniformArity=R.prototype.assertChoicesHaveUniformArity=M.prototype.assertChoicesHaveUniformArity=C.prototype.assertChoicesHaveUniformArity=function(t){};S.prototype.assertChoicesHaveUniformArity=function(t){if(this.terms.length===0)return;let e=this.terms[0].getArity();for(let n=0;n<this.terms.length;n++){let r=this.terms[n];r.assertChoicesHaveUniformArity();let s=r.getArity();if(e!==s)throw hn(t,e,s,r)}};he.prototype.assertChoicesHaveUniformArity=function(t){let e=this.terms[0].getArity(),n=this.terms[1].getArity();if(e!==n)throw hn(t,n,e,this.terms[0])};O.prototype.assertChoicesHaveUniformArity=function(t){for(let e=0;e<this.factors.length;e++)this.factors[e].assertChoicesHaveUniformArity(t)};k.prototype.assertChoicesHaveUniformArity=function(t){this.expr.assertChoicesHaveUniformArity(t)};P.prototype.assertChoicesHaveUniformArity=function(t){};$.prototype.assertChoicesHaveUniformArity=function(t){this.expr.assertChoicesHaveUniformArity(t)};b.prototype.assertChoicesHaveUniformArity=function(t){};I.prototype.assertIteratedExprsAreNotNullable=j("assertIteratedExprsAreNotNullable");F.assertIteratedExprsAreNotNullable=D.assertIteratedExprsAreNotNullable=L.prototype.assertIteratedExprsAreNotNullable=T.prototype.assertIteratedExprsAreNotNullable=R.prototype.assertIteratedExprsAreNotNullable=C.prototype.assertIteratedExprsAreNotNullable=function(t){};S.prototype.assertIteratedExprsAreNotNullable=function(t){for(let e=0;e<this.terms.length;e++)this.terms[e].assertIteratedExprsAreNotNullable(t)};O.prototype.assertIteratedExprsAreNotNullable=function(t){for(let e=0;e<this.factors.length;e++)this.factors[e].assertIteratedExprsAreNotNullable(t)};k.prototype.assertIteratedExprsAreNotNullable=function(t){if(this.expr.assertIteratedExprsAreNotNullable(t),this.expr.isNullable(t))throw pn(this,[])};Q.prototype.assertIteratedExprsAreNotNullable=P.prototype.assertIteratedExprsAreNotNullable=$.prototype.assertIteratedExprsAreNotNullable=M.prototype.assertIteratedExprsAreNotNullable=function(t){this.expr.assertIteratedExprsAreNotNullable(t)};b.prototype.assertIteratedExprsAreNotNullable=function(t){this.args.forEach(e=>{e.assertIteratedExprsAreNotNullable(t)})};var Le=class{constructor(e){this.matchLength=e}get ctorName(){throw new Error("subclass responsibility")}numChildren(){return this.children?this.children.length:0}childAt(e){if(this.children)return this.children[e]}indexOfChild(e){return this.children.indexOf(e)}hasChildren(){return this.numChildren()>0}hasNoChildren(){return!this.hasChildren()}onlyChild(){if(this.numChildren()!==1)throw new Error("cannot get only child of a node of type "+this.ctorName+" (it has "+this.numChildren()+" children)");return this.firstChild()}firstChild(){if(this.hasNoChildren())throw new Error("cannot get first child of a "+this.ctorName+" node, which has no children");return this.childAt(0)}lastChild(){if(this.hasNoChildren())throw new Error("cannot get last child of a "+this.ctorName+" node, which has no children");return this.childAt(this.numChildren()-1)}childBefore(e){let n=this.indexOfChild(e);if(n<0)throw new Error("Node.childBefore() called w/ an argument that is not a child");if(n===0)throw new Error("cannot get child before first child");return this.childAt(n-1)}childAfter(e){let n=this.indexOfChild(e);if(n<0)throw new Error("Node.childAfter() called w/ an argument that is not a child");if(n===this.numChildren()-1)throw new Error("cannot get child after last child");return this.childAt(n+1)}isTerminal(){return!1}isNonterminal(){return!1}isIteration(){return!1}isOptional(){return!1}},ae=class extends Le{get ctorName(){return"_terminal"}isTerminal(){return!0}get primitiveValue(){throw new Error("The `primitiveValue` property was removed in Ohm v17.")}},mt=class extends Le{constructor(e,n,r,s){super(s),this.ruleName=e,this.children=n,this.childOffsets=r}get ctorName(){return this.ruleName}isNonterminal(){return!0}isLexical(){return rn(this.ctorName)}isSyntactic(){return pe(this.ctorName)}},je=class extends Le{constructor(e,n,r,s){super(r),this.children=e,this.childOffsets=n,this.optional=s}get ctorName(){return"_iter"}isIteration(){return!0}isOptional(){return this.optional}};I.prototype.eval=j("eval");F.eval=function(t){let{inputStream:e}=t,n=e.pos,r=e.nextCodePoint();return r!==void 0?(t.pushBinding(new ae(String.fromCodePoint(r).length),n),!0):(t.processFailure(n,this),!1)};D.eval=function(t){let{inputStream:e}=t,n=e.pos;return e.atEnd()?(t.pushBinding(new ae(0),n),!0):(t.processFailure(n,this),!1)};L.prototype.eval=function(t){let{inputStream:e}=t,n=e.pos;return e.matchString(this.obj)?(t.pushBinding(new ae(this.obj.length),n),!0):(t.processFailure(n,this),!1)};T.prototype.eval=function(t){let{inputStream:e}=t,n=e.pos,r=this.matchCodePoint?e.nextCodePoint():e.nextCharCode();return r!==void 0&&this.from.codePointAt(0)<=r&&r<=this.to.codePointAt(0)?(t.pushBinding(new ae(String.fromCodePoint(r).length),n),!0):(t.processFailure(n,this),!1)};R.prototype.eval=function(t){return t.eval(t.currentApplication().args[this.index])};M.prototype.eval=function(t){t.enterLexifiedContext();let e=t.eval(this.expr);return t.exitLexifiedContext(),e};S.prototype.eval=function(t){for(let e=0;e<this.terms.length;e++)if(t.eval(this.terms[e]))return!0;return!1};O.prototype.eval=function(t){for(let e=0;e<this.factors.length;e++){let n=this.factors[e];if(!t.eval(n))return!1}return!0};k.prototype.eval=function(t){let{inputStream:e}=t,n=e.pos,r=this.getArity(),s=[],i=[];for(;s.length<r;)s.push([]),i.push([]);let a=0,l=n,o;for(;a<this.maxNumMatches&&t.eval(this.expr);){if(e.pos===l)throw pn(this,t._applicationStack);l=e.pos,a++;let p=t._bindings.splice(t._bindings.length-r,r),h=t._bindingOffsets.splice(t._bindingOffsets.length-r,r);for(o=0;o<p.length;o++)s[o].push(p[o]),i[o].push(h[o])}if(a<this.minNumMatches)return!1;let d=t.posToOffset(n),c=0;if(a>0){let p=s[r-1],h=i[r-1],f=h[h.length-1]+p[p.length-1].matchLength;d=i[0][0],c=f-d}let u=this instanceof Q;for(o=0;o<s.length;o++)t._bindings.push(new je(s[o],i[o],c,u)),t._bindingOffsets.push(d);return!0};P.prototype.eval=function(t){let{inputStream:e}=t,n=e.pos;t.pushFailuresInfo();let r=t.eval(this.expr);return t.popFailuresInfo(),r?(t.processFailure(n,this),!1):(e.pos=n,!0)};$.prototype.eval=function(t){let{inputStream:e}=t,n=e.pos;return t.eval(this.expr)?(e.pos=n,!0):!1};b.prototype.eval=function(t){let e=t.currentApplication(),n=e?e.args:[],r=this.substituteParams(n),s=t.getCurrentPosInfo();if(s.isActive(r))return r.handleCycle(t);let i=r.toMemoKey(),a=s.memo[i];if(a&&s.shouldUseMemoizedResult(a)){if(t.hasNecessaryInfo(a))return t.useMemoizedResult(t.inputStream.pos,a);delete s.memo[i]}return r.reallyEval(t)};b.prototype.handleCycle=function(t){let e=t.getCurrentPosInfo(),{currentLeftRecursion:n}=e,r=this.toMemoKey(),s=e.memo[r];return n&&n.headApplication.toMemoKey()===r?s.updateInvolvedApplicationMemoKeys():s||(s=e.memoize(r,{matchLength:0,examinedLength:0,value:!1,rightmostFailureOffset:-1}),e.startLeftRecursion(this,s)),t.useMemoizedResult(t.inputStream.pos,s)};b.prototype.reallyEval=function(t){let{inputStream:e}=t,n=e.pos,r=t.getCurrentPosInfo(),s=t.grammar.rules[this.ruleName],{body:i}=s,{description:a}=s;t.enterApplication(r,this),a&&t.pushFailuresInfo();let l=e.examinedLength;e.examinedLength=0;let o=this.evalOnce(i,t),d=r.currentLeftRecursion,c=this.toMemoKey(),u=d&&d.headApplication.toMemoKey()===c,p;t.doNotMemoize?t.doNotMemoize=!1:u?(o=this.growSeedResult(i,t,n,d,o),r.endLeftRecursion(),p=d,p.examinedLength=e.examinedLength-n,p.rightmostFailureOffset=t._getRightmostFailureOffset(),r.memoize(c,p)):(!d||!d.isInvolved(c))&&(p=r.memoize(c,{matchLength:e.pos-n,examinedLength:e.examinedLength-n,value:o,failuresAtRightmostPosition:t.cloneRecordedFailures(),rightmostFailureOffset:t._getRightmostFailureOffset()}));let h=!!o;if(a&&(t.popFailuresInfo(),h||t.processFailure(n,this),p&&(p.failuresAtRightmostPosition=t.cloneRecordedFailures())),t.isTracing()&&p){let f=t.getTraceEntry(n,this,h,h?[o]:[]);u&&(ce(f.terminatingLREntry!=null||!h),f.isHeadOfLeftRecursion=!0),p.traceEntry=f}return e.examinedLength=Math.max(e.examinedLength,l),t.exitApplication(r,o),h};b.prototype.evalOnce=function(t,e){let{inputStream:n}=e,r=n.pos;if(e.eval(t)){let s=t.getArity(),i=e._bindings.splice(e._bindings.length-s,s),a=e._bindingOffsets.splice(e._bindingOffsets.length-s,s),l=n.pos-r;return new mt(this.ruleName,i,a,l)}else return!1};b.prototype.growSeedResult=function(t,e,n,r,s){if(!s)return!1;let{inputStream:i}=e;for(;;){if(r.matchLength=i.pos-n,r.value=s,r.failuresAtRightmostPosition=e.cloneRecordedFailures(),e.isTracing()){let a=e.trace[e.trace.length-1];r.traceEntry=new xe(e.input,n,i.pos,this,!0,[s],[a.clone()])}if(i.pos=n,s=this.evalOnce(t,e),i.pos-n<=r.matchLength)break;e.isTracing()&&e.trace.splice(-2,1)}return e.isTracing()&&r.traceEntry.recordLRTermination(e.trace.pop(),s),i.pos=n+r.matchLength,r.value};C.prototype.eval=function(t){let{inputStream:e}=t,n=e.pos,r=e.nextCodePoint();if(r!==void 0&&r<=vr){let s=String.fromCodePoint(r);if(this.pattern.test(s))return t.pushBinding(new ae(s.length),n),!0}return t.processFailure(n,this),!1};I.prototype.getArity=j("getArity");F.getArity=D.getArity=L.prototype.getArity=T.prototype.getArity=R.prototype.getArity=b.prototype.getArity=C.prototype.getArity=function(){return 1};S.prototype.getArity=function(){return this.terms.length===0?0:this.terms[0].getArity()};O.prototype.getArity=function(){let t=0;for(let e=0;e<this.factors.length;e++)t+=this.factors[e].getArity();return t};k.prototype.getArity=function(){return this.expr.getArity()};P.prototype.getArity=function(){return 0};$.prototype.getArity=M.prototype.getArity=function(){return this.expr.getArity()};function Y(t,e){let n={};if(t.source&&e){let r=t.source.relativeTo(e);n.sourceInterval=[r.startIdx,r.endIdx]}return n}I.prototype.outputRecipe=j("outputRecipe");F.outputRecipe=function(t,e){return["any",Y(this,e)]};D.outputRecipe=function(t,e){return["end",Y(this,e)]};L.prototype.outputRecipe=function(t,e){return["terminal",Y(this,e),this.obj]};T.prototype.outputRecipe=function(t,e){return["range",Y(this,e),this.from,this.to]};R.prototype.outputRecipe=function(t,e){return["param",Y(this,e),this.index]};S.prototype.outputRecipe=function(t,e){return["alt",Y(this,e)].concat(this.terms.map(n=>n.outputRecipe(t,e)))};he.prototype.outputRecipe=function(t,e){return this.terms[0].outputRecipe(t,e)};de.prototype.outputRecipe=function(t,e){let n=this.terms.slice(0,this.expansionPos),r=this.terms.slice(this.expansionPos+1);return["splice",Y(this,e),n.map(s=>s.outputRecipe(t,e)),r.map(s=>s.outputRecipe(t,e))]};O.prototype.outputRecipe=function(t,e){return["seq",Y(this,e)].concat(this.factors.map(n=>n.outputRecipe(t,e)))};ee.prototype.outputRecipe=ie.prototype.outputRecipe=Q.prototype.outputRecipe=P.prototype.outputRecipe=$.prototype.outputRecipe=M.prototype.outputRecipe=function(t,e){return[this.constructor.name.toLowerCase(),Y(this,e),this.expr.outputRecipe(t,e)]};b.prototype.outputRecipe=function(t,e){return["app",Y(this,e),this.ruleName,this.args.map(n=>n.outputRecipe(t,e))]};C.prototype.outputRecipe=function(t,e){return["unicodeChar",Y(this,e),this.categoryOrProp]};I.prototype.introduceParams=j("introduceParams");F.introduceParams=D.introduceParams=L.prototype.introduceParams=T.prototype.introduceParams=R.prototype.introduceParams=C.prototype.introduceParams=function(t){return this};S.prototype.introduceParams=function(t){return this.terms.forEach((e,n,r)=>{r[n]=e.introduceParams(t)}),this};O.prototype.introduceParams=function(t){return this.factors.forEach((e,n,r)=>{r[n]=e.introduceParams(t)}),this};k.prototype.introduceParams=P.prototype.introduceParams=$.prototype.introduceParams=M.prototype.introduceParams=function(t){return this.expr=this.expr.introduceParams(t),this};b.prototype.introduceParams=function(t){let e=t.indexOf(this.ruleName);if(e>=0){if(this.args.length>0)throw new Error("Parameterized rules cannot be passed as arguments to another rule.");return new R(e).withSource(this.source)}else return this.args.forEach((n,r,s)=>{s[r]=n.introduceParams(t)}),this};I.prototype.isNullable=function(t){return this._isNullable(t,Object.create(null))};I.prototype._isNullable=j("_isNullable");F._isNullable=T.prototype._isNullable=R.prototype._isNullable=ie.prototype._isNullable=C.prototype._isNullable=function(t,e){return!1};D._isNullable=function(t,e){return!0};L.prototype._isNullable=function(t,e){return typeof this.obj=="string"?this.obj==="":!1};S.prototype._isNullable=function(t,e){return this.terms.length===0||this.terms.some(n=>n._isNullable(t,e))};O.prototype._isNullable=function(t,e){return this.factors.every(n=>n._isNullable(t,e))};ee.prototype._isNullable=Q.prototype._isNullable=P.prototype._isNullable=$.prototype._isNullable=function(t,e){return!0};M.prototype._isNullable=function(t,e){return this.expr._isNullable(t,e)};b.prototype._isNullable=function(t,e){let n=this.toMemoKey();if(!Object.prototype.hasOwnProperty.call(e,n)){let{body:r}=t.rules[this.ruleName],s=r.substituteParams(this.args);e[n]=!1,e[n]=s._isNullable(t,e)}return e[n]};I.prototype.substituteParams=j("substituteParams");F.substituteParams=D.substituteParams=L.prototype.substituteParams=T.prototype.substituteParams=C.prototype.substituteParams=function(t){return this};R.prototype.substituteParams=function(t){return on(t[this.index])};S.prototype.substituteParams=function(t){return new S(this.terms.map(e=>e.substituteParams(t)))};O.prototype.substituteParams=function(t){return new O(this.factors.map(e=>e.substituteParams(t)))};k.prototype.substituteParams=P.prototype.substituteParams=$.prototype.substituteParams=M.prototype.substituteParams=function(t){return new this.constructor(this.expr.substituteParams(t))};b.prototype.substituteParams=function(t){if(this.args.length===0)return this;{let e=this.args.map(n=>n.substituteParams(t));return new b(this.ruleName,e)}};function Kt(t){return/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(t)}function St(t){let e=Object.create(null);t.forEach(n=>{e[n]=(e[n]||0)+1}),Object.keys(e).forEach(n=>{if(e[n]<=1)return;let r=1;t.forEach((s,i)=>{s===n&&(t[i]=s+"_"+r++)})})}I.prototype.toArgumentNameList=j("toArgumentNameList");F.toArgumentNameList=function(t,e){return["any"]};D.toArgumentNameList=function(t,e){return["end"]};L.prototype.toArgumentNameList=function(t,e){return typeof this.obj=="string"&&/^[_a-zA-Z0-9]+$/.test(this.obj)?["_"+this.obj]:["$"+t]};T.prototype.toArgumentNameList=function(t,e){let n=this.from+"_to_"+this.to;return Kt(n)||(n="_"+n),Kt(n)||(n="$"+t),[n]};S.prototype.toArgumentNameList=function(t,e){let n=this.terms.map(i=>i.toArgumentNameList(t,!0)),r=[],s=n[0].length;for(let i=0;i<s;i++){let a=[];for(let o=0;o<this.terms.length;o++)a.push(n[o][i]);let l=nn(a);r.push(l.join("_or_"))}return e||St(r),r};O.prototype.toArgumentNameList=function(t,e){let n=[];return this.factors.forEach(r=>{let s=r.toArgumentNameList(t,!0);n=n.concat(s),t+=s.length}),e||St(n),n};k.prototype.toArgumentNameList=function(t,e){let n=this.expr.toArgumentNameList(t,e).map(r=>r[r.length-1]==="s"?r+"es":r+"s");return e||St(n),n};Q.prototype.toArgumentNameList=function(t,e){return this.expr.toArgumentNameList(t,e).map(n=>"opt"+n[0].toUpperCase()+n.slice(1))};P.prototype.toArgumentNameList=function(t,e){return[]};$.prototype.toArgumentNameList=M.prototype.toArgumentNameList=function(t,e){return this.expr.toArgumentNameList(t,e)};b.prototype.toArgumentNameList=function(t,e){return[this.ruleName]};C.prototype.toArgumentNameList=function(t,e){return["$"+t]};R.prototype.toArgumentNameList=function(t,e){return["param"+this.index]};I.prototype.toDisplayString=j("toDisplayString");S.prototype.toDisplayString=O.prototype.toDisplayString=function(){return this.source?this.source.trimmed().contents:"["+this.constructor.name+"]"};F.toDisplayString=D.toDisplayString=k.prototype.toDisplayString=P.prototype.toDisplayString=$.prototype.toDisplayString=M.prototype.toDisplayString=L.prototype.toDisplayString=T.prototype.toDisplayString=R.prototype.toDisplayString=function(){return this.toString()};b.prototype.toDisplayString=function(){if(this.args.length>0){let t=this.args.map(e=>e.toDisplayString());return this.ruleName+"<"+t.join(",")+">"}else return this.ruleName};C.prototype.toDisplayString=function(){return"Unicode ["+this.categoryOrProp+"] character"};function Nr(t){return t==="description"||t==="string"||t==="code"}var z=class t{constructor(e,n,r){if(!Nr(r))throw new Error("invalid Failure type: "+r);this.pexpr=e,this.text=n,this.type=r,this.fluffy=!1}getPExpr(){return this.pexpr}getText(){return this.text}getType(){return this.type}isDescription(){return this.type==="description"}isStringTerminal(){return this.type==="string"}isCode(){return this.type==="code"}isFluffy(){return this.fluffy}makeFluffy(){this.fluffy=!0}clearFluffy(){this.fluffy=!1}subsumes(e){return this.getText()===e.getText()&&this.type===e.type&&(!this.isFluffy()||this.isFluffy()&&e.isFluffy())}toString(){return this.type==="string"?JSON.stringify(this.getText()):this.getText()}clone(){let e=new t(this.pexpr,this.text,this.type);return this.isFluffy()&&e.makeFluffy(),e}toKey(){return this.toString()+"#"+this.type}};I.prototype.toFailure=j("toFailure");F.toFailure=function(t){return new z(this,"any object","description")};D.toFailure=function(t){return new z(this,"end of input","description")};L.prototype.toFailure=function(t){return new z(this,this.obj,"string")};T.prototype.toFailure=function(t){return new z(this,JSON.stringify(this.from)+".."+JSON.stringify(this.to),"code")};P.prototype.toFailure=function(t){let e=this.expr===F?"nothing":"not "+this.expr.toFailure(t);return new z(this,e,"description")};$.prototype.toFailure=function(t){return this.expr.toFailure(t)};b.prototype.toFailure=function(t){let{description:e}=t.rules[this.ruleName];return e||(e=(/^[aeiouAEIOU]/.test(this.ruleName)?"an":"a")+" "+this.ruleName),new z(this,e,"description")};C.prototype.toFailure=function(t){return new z(this,"a Unicode ["+this.categoryOrProp+"] character","description")};S.prototype.toFailure=function(t){let n="("+this.terms.map(r=>r.toFailure(t)).join(" or ")+")";return new z(this,n,"description")};O.prototype.toFailure=function(t){let n="("+this.factors.map(r=>r.toFailure(t)).join(" ")+")";return new z(this,n,"description")};k.prototype.toFailure=function(t){let e="("+this.expr.toFailure(t)+this.operator+")";return new z(this,e,"description")};I.prototype.toString=j("toString");F.toString=function(){return"any"};D.toString=function(){return"end"};L.prototype.toString=function(){return JSON.stringify(this.obj)};T.prototype.toString=function(){return JSON.stringify(this.from)+".."+JSON.stringify(this.to)};R.prototype.toString=function(){return"$"+this.index};M.prototype.toString=function(){return"#("+this.expr.toString()+")"};S.prototype.toString=function(){return this.terms.length===1?this.terms[0].toString():"("+this.terms.map(t=>t.toString()).join(" | ")+")"};O.prototype.toString=function(){return this.factors.length===1?this.factors[0].toString():"("+this.factors.map(t=>t.toString()).join(" ")+")"};k.prototype.toString=function(){return this.expr+this.operator};P.prototype.toString=function(){return"~"+this.expr};$.prototype.toString=function(){return"&"+this.expr};b.prototype.toString=function(){if(this.args.length>0){let t=this.args.map(e=>e.toString());return this.ruleName+"<"+t.join(",")+">"}else return this.ruleName};C.prototype.toString=function(){return"\\p{"+this.categoryOrProp+"}"};var qe=class t extends I{constructor(e){super(),this.obj=e}_getString(e){let n=e.currentApplication().args[this.obj.index];return ce(n instanceof L,"expected a Terminal expression"),n.obj}allowsSkippingPrecedingSpace(){return!0}eval(e){let{inputStream:n}=e,r=n.pos,s=this._getString(e);return n.matchString(s,!0)?(e.pushBinding(new ae(s.length),r),!0):(e.processFailure(r,this),!1)}getArity(){return 1}substituteParams(e){return new t(this.obj.substituteParams(e))}toDisplayString(){return this.obj.toDisplayString()+" (case-insensitive)"}toFailure(e){return new z(this,this.obj.toFailure(e)+" (case-insensitive)","description")}_isNullable(e,n){return this.obj._isNullable(e,n)}},Cr=Object.freeze({__proto__:null,CaseInsensitiveTerminal:qe,PExpr:I,any:F,end:D,Terminal:L,Range:T,Param:R,Alt:S,Extend:he,Splice:de,Seq:O,Iter:k,Star:ee,Plus:ie,Opt:Q,Not:P,Lookahead:$,Lex:M,Apply:b,UnicodeChar:C}),mn;dn(t=>{mn=t.rules.applySyntactic.body});var at=new b("spaces"),gt=class{constructor(e,n,r){this.matcher=e,this.startExpr=n,this.grammar=e.grammar,this.input=e.getInput(),this.inputStream=new be(this.input),this.memoTable=e._memoTable,this.userData=void 0,this.doNotMemoize=!1,this._bindings=[],this._bindingOffsets=[],this._applicationStack=[],this._posStack=[0],this.inLexifiedContextStack=[!1],this.rightmostFailurePosition=-1,this._rightmostFailurePositionStack=[],this._recordedFailuresStack=[],r!==void 0&&(this.positionToRecordFailures=r,this.recordedFailures=Object.create(null))}posToOffset(e){return e-this._posStack[this._posStack.length-1]}enterApplication(e,n){this._posStack.push(this.inputStream.pos),this._applicationStack.push(n),this.inLexifiedContextStack.push(!1),e.enter(n),this._rightmostFailurePositionStack.push(this.rightmostFailurePosition),this.rightmostFailurePosition=-1}exitApplication(e,n){let r=this._posStack.pop();this._applicationStack.pop(),this.inLexifiedContextStack.pop(),e.exit(),this.rightmostFailurePosition=Math.max(this.rightmostFailurePosition,this._rightmostFailurePositionStack.pop()),n&&this.pushBinding(n,r)}enterLexifiedContext(){this.inLexifiedContextStack.push(!0)}exitLexifiedContext(){this.inLexifiedContextStack.pop()}currentApplication(){return this._applicationStack[this._applicationStack.length-1]}inSyntacticContext(){let e=this.currentApplication();return e?e.isSyntactic()&&!this.inLexifiedContext():this.startExpr.factors[0].isSyntactic()}inLexifiedContext(){return this.inLexifiedContextStack[this.inLexifiedContextStack.length-1]}skipSpaces(){return this.pushFailuresInfo(),this.eval(at),this.popBinding(),this.popFailuresInfo(),this.inputStream.pos}skipSpacesIfInSyntacticContext(){return this.inSyntacticContext()?this.skipSpaces():this.inputStream.pos}maybeSkipSpacesBefore(e){return e.allowsSkippingPrecedingSpace()&&e!==at?this.skipSpacesIfInSyntacticContext():this.inputStream.pos}pushBinding(e,n){this._bindings.push(e),this._bindingOffsets.push(this.posToOffset(n))}popBinding(){this._bindings.pop(),this._bindingOffsets.pop()}numBindings(){return this._bindings.length}truncateBindings(e){for(;this._bindings.length>e;)this.popBinding()}getCurrentPosInfo(){return this.getPosInfo(this.inputStream.pos)}getPosInfo(e){let n=this.memoTable[e];return n||(n=this.memoTable[e]=new dt),n}processFailure(e,n){if(this.rightmostFailurePosition=Math.max(this.rightmostFailurePosition,e),this.recordedFailures&&e===this.positionToRecordFailures){let r=this.currentApplication();r&&(n=n.substituteParams(r.args)),this.recordFailure(n.toFailure(this.grammar),!1)}}recordFailure(e,n){let r=e.toKey();this.recordedFailures[r]?this.recordedFailures[r].isFluffy()&&!e.isFluffy()&&this.recordedFailures[r].clearFluffy():this.recordedFailures[r]=n?e.clone():e}recordFailures(e,n){Object.keys(e).forEach(r=>{this.recordFailure(e[r],n)})}cloneRecordedFailures(){if(!this.recordedFailures)return;let e=Object.create(null);return Object.keys(this.recordedFailures).forEach(n=>{e[n]=this.recordedFailures[n].clone()}),e}getRightmostFailurePosition(){return this.rightmostFailurePosition}_getRightmostFailureOffset(){return this.rightmostFailurePosition>=0?this.posToOffset(this.rightmostFailurePosition):-1}getMemoizedTraceEntry(e,n){let r=this.memoTable[e];if(r&&n instanceof b){let s=r.memo[n.toMemoKey()];if(s&&s.traceEntry){let i=s.traceEntry.cloneWithExpr(n);return i.isMemoized=!0,i}}return null}getTraceEntry(e,n,r,s){if(n instanceof b){let i=this.currentApplication(),a=i?i.args:[];n=n.substituteParams(a)}return this.getMemoizedTraceEntry(e,n)||new xe(this.input,e,this.inputStream.pos,n,r,s,this.trace)}isTracing(){return!!this.trace}hasNecessaryInfo(e){return this.trace&&!e.traceEntry?!1:this.recordedFailures&&this.inputStream.pos+e.rightmostFailureOffset===this.positionToRecordFailures?!!e.failuresAtRightmostPosition:!0}useMemoizedResult(e,n){this.trace&&this.trace.push(n.traceEntry);let r=this.inputStream.pos+n.rightmostFailureOffset;return this.rightmostFailurePosition=Math.max(this.rightmostFailurePosition,r),this.recordedFailures&&this.positionToRecordFailures===r&&n.failuresAtRightmostPosition&&this.recordFailures(n.failuresAtRightmostPosition,!0),this.inputStream.examinedLength=Math.max(this.inputStream.examinedLength,n.examinedLength+e),n.value?(this.inputStream.pos+=n.matchLength,this.pushBinding(n.value,e),!0):!1}eval(e){let{inputStream:n}=this,r=this._bindings.length,s=this.userData,i;this.recordedFailures&&(i=this.recordedFailures,this.recordedFailures=Object.create(null));let a=n.pos,l=this.maybeSkipSpacesBefore(e),o;this.trace&&(o=this.trace,this.trace=[]);let d=e.eval(this);if(this.trace){let c=this._bindings.slice(r),u=this.getTraceEntry(l,e,d,c);u.isImplicitSpaces=e===at,u.isRootNode=e===this.startExpr,o.push(u),this.trace=o}return d?this.recordedFailures&&n.pos===this.positionToRecordFailures&&Object.keys(this.recordedFailures).forEach(c=>{this.recordedFailures[c].makeFluffy()}):(n.pos=a,this.truncateBindings(r),this.userData=s),this.recordedFailures&&this.recordFailures(i,!1),e===mn&&this.skipSpaces(),d}getMatchResult(){this.grammar._setUpMatchState(this),this.eval(this.startExpr);let e;this.recordedFailures&&(e=Object.keys(this.recordedFailures).map(r=>this.recordedFailures[r]));let n=this._bindings[0];return n&&(n.grammar=this.grammar),new Fe(this.matcher,this.input,this.startExpr,n,this._bindingOffsets[0],this.rightmostFailurePosition,e)}getTrace(){this.trace=[];let e=this.getMatchResult(),n=this.trace[this.trace.length-1];return n.result=e,n}pushFailuresInfo(){this._rightmostFailurePositionStack.push(this.rightmostFailurePosition),this._recordedFailuresStack.push(this.recordedFailures)}popFailuresInfo(){this.rightmostFailurePosition=this._rightmostFailurePositionStack.pop(),this.recordedFailures=this._recordedFailuresStack.pop()}},yt=class{constructor(e){this.grammar=e,this._memoTable=[],this._input="",this._isMemoTableStale=!1}_resetMemoTable(){this._memoTable=[],this._isMemoTableStale=!1}getInput(){return this._input}setInput(e){return this._input!==e&&this.replaceInputRange(0,this._input.length,e),this}replaceInputRange(e,n,r){let s=this._input,i=this._memoTable;if(e<0||e>s.length||n<0||n>s.length||e>n)throw new Error("Invalid indices: "+e+" and "+n);this._input=s.slice(0,e)+r+s.slice(n),this._input!==s&&i.length>0&&(this._isMemoTableStale=!0);let a=i.slice(n);i.length=e;for(let l=0;l<r.length;l++)i.push(void 0);for(let l of a)i.push(l);for(let l=0;l<e;l++){let o=i[l];o&&o.clearObsoleteEntries(l,e)}return this}match(e,n={incremental:!0}){return this._match(this._getStartExpr(e),{incremental:n.incremental,tracing:!1})}trace(e,n={incremental:!0}){return this._match(this._getStartExpr(e),{incremental:n.incremental,tracing:!0})}_match(e,n={}){let r={tracing:!1,incremental:!0,positionToRecordFailures:void 0,...n};if(!r.incremental)this._resetMemoTable();else if(this._isMemoTableStale&&!this.grammar.supportsIncrementalParsing)throw er(this.grammar);let s=new gt(this,e,r.positionToRecordFailures);return r.tracing?s.getTrace():s.getMatchResult()}_getStartExpr(e){let n=e||this.grammar.defaultStartRule;if(!n)throw new Error("Missing start rule argument -- the grammar has no default start rule.");let r=this.grammar.parseApplication(n);return new O([r,D])}},Ce=[],vt=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),Be=class{constructor(e,n,r){this._node=e,this.source=n,this._baseInterval=r,e.isNonterminal()&&ce(n===r),this._childWrappers=[]}_forgetMemoizedResultFor(e){delete this._node[this._semantics.attributeKeys[e]],this.children.forEach(n=>{n._forgetMemoizedResultFor(e)})}child(e){if(!(0<=e&&e<this._node.numChildren()))return;let n=this._childWrappers[e];if(!n){let r=this._node.childAt(e),s=this._node.childOffsets[e],i=this._baseInterval.subInterval(s,r.matchLength),a=r.isNonterminal()?i:this._baseInterval;n=this._childWrappers[e]=this._semantics.wrap(r,i,a)}return n}_children(){for(let e=0;e<this._node.numChildren();e++)this.child(e);return this._childWrappers}isIteration(){return this._node.isIteration()}isTerminal(){return this._node.isTerminal()}isNonterminal(){return this._node.isNonterminal()}isSyntactic(){return this.isNonterminal()&&this._node.isSyntactic()}isLexical(){return this.isNonterminal()&&this._node.isLexical()}isOptional(){return this._node.isOptional()}iteration(e){let n=e||[],r=n.map(a=>a._node),s=new je(r,[],-1,!1),i=this._semantics.wrap(s,null,null);return i._childWrappers=n,i}get children(){return this._children()}get ctorName(){return this._node.ctorName}get numChildren(){return this._node.numChildren()}get sourceString(){return this.source.contents}},G=class t{constructor(e,n){let r=this;if(this.grammar=e,this.checkedActionDicts=!1,this.Wrapper=class extends(n?n.Wrapper:Be){constructor(s,i,a){super(s,i,a),r.checkActionDictsIfHaventAlready(),this._semantics=r}toString(){return"[semantics wrapper for "+r.grammar.name+"]"}},this.super=n,n){if(!(e.equals(this.super.grammar)||e._inheritsFrom(this.super.grammar)))throw new Error("Cannot extend a semantics for grammar '"+this.super.grammar.name+"' for use with grammar '"+e.name+"' (not a sub-grammar)");this.operations=Object.create(this.super.operations),this.attributes=Object.create(this.super.attributes),this.attributeKeys=Object.create(null);for(let s in this.attributes)Object.defineProperty(this.attributeKeys,s,{value:Qt(s)})}else this.operations=Object.create(null),this.attributes=Object.create(null),this.attributeKeys=Object.create(null)}toString(){return"[semantics for "+this.grammar.name+"]"}checkActionDictsIfHaventAlready(){this.checkedActionDicts||(this.checkActionDicts(),this.checkedActionDicts=!0)}checkActionDicts(){let e;for(e in this.operations)this.operations[e].checkActionDict(this.grammar);for(e in this.attributes)this.attributes[e].checkActionDict(this.grammar)}toRecipe(e){function n(s){return s.super!==t.BuiltInSemantics._getSemantics()}let r=`(function(g) {
`;if(n(this)){r+="  var semantics = "+this.super.toRecipe(!0)+"(g";let s=this.super.grammar,i=this.grammar;for(;i!==s;)r+=".superGrammar",i=i.superGrammar;r+=`);
`,r+="  return g.extendSemantics(semantics)"}else r+="  return g.createSemantics()";return["Operation","Attribute"].forEach(s=>{let i=this[s.toLowerCase()+"s"];Object.keys(i).forEach(a=>{let{actionDict:l,formals:o,builtInDefault:d}=i[a],c=a;o.length>0&&(c+="("+o.join(", ")+")");let u;n(this)&&this.super[s.toLowerCase()+"s"][a]?u="extend"+s:u="add"+s,r+=`
    .`+u+"("+JSON.stringify(c)+", {";let p=[];Object.keys(l).forEach(h=>{if(l[h]!==d){let f=l[h].toString().trim();f=f.replace(/^.*\(/,"function("),p.push(`
      `+JSON.stringify(h)+": "+f)}}),r+=p.join(",")+`
    })`})}),r+=`;
  })`,e||(r=`(function() {
  var grammar = this.fromRecipe(`+this.grammar.toRecipe()+`);
  var semantics = `+r+`(grammar);
  return semantics;
});
`),r}addOperationOrAttribute(e,n,r){let s=e+"s",i=Wt(n,e),{name:a}=i,{formals:l}=i;this.assertNewName(a,e);let o=Lr(e,a,u),d={_default:o};Object.keys(r).forEach(p=>{d[p]=r[p]});let c=e==="operation"?new me(a,l,d,o):new Te(a,d,o);c.checkActionDict(this.grammar),this[s][a]=c;function u(...p){let h=this._semantics[s][a];if(arguments.length!==h.formals.length)throw new Error("Invalid number of arguments passed to "+a+" "+e+" (expected "+h.formals.length+", got "+arguments.length+")");let f=Object.create(null);for(let[g,v]of Object.entries(p)){let N=h.formals[g];f[N]=v}let m=this.args;this.args=f;let y=h.execute(this._semantics,this);return this.args=m,y}e==="operation"?(this.Wrapper.prototype[a]=u,this.Wrapper.prototype[a].toString=function(){return"["+a+" operation]"}):(Object.defineProperty(this.Wrapper.prototype,a,{get:u,configurable:!0}),Object.defineProperty(this.attributeKeys,a,{value:Qt(a)}))}extendOperationOrAttribute(e,n,r){let s=e+"s";if(Wt(n,"attribute"),!(this.super&&n in this.super[s]))throw new Error("Cannot extend "+e+" '"+n+"': did not inherit an "+e+" with that name");if(vt(this[s],n))throw new Error("Cannot extend "+e+" '"+n+"' again");let i=this[s][n].formals,a=this[s][n].actionDict,l=Object.create(a);Object.keys(r).forEach(o=>{l[o]=r[o]}),this[s][n]=e==="operation"?new me(n,i,l):new Te(n,l),this[s][n].checkActionDict(this.grammar)}assertNewName(e,n){if(vt(Be.prototype,e))throw new Error("Cannot add "+n+" '"+e+"': that's a reserved name");if(e in this.operations)throw new Error("Cannot add "+n+" '"+e+"': an operation with that name already exists");if(e in this.attributes)throw new Error("Cannot add "+n+" '"+e+"': an attribute with that name already exists")}wrap(e,n,r){let s=r||n;return e instanceof this.Wrapper?e:new this.Wrapper(e,n,s)}};function Wt(t,e){if(!G.prototypeGrammar)return ce(t.indexOf("(")===-1),{name:t,formals:[]};let n=G.prototypeGrammar.match(t,e==="operation"?"OperationSignature":"AttributeSignature");if(n.failed())throw new Error(n.message);return G.prototypeGrammarSemantics(n).parse()}function Lr(t,e,n){return function(...r){let i=(this._semantics.operations[e]||this._semantics.attributes[e]).formals.map(a=>this.args[a]);if(!this.isIteration()&&r.length===1)return n.apply(r[0],i);throw hr(this.ctorName,e,t,Ce)}}G.createSemantics=function(t,e){let n=new G(t,e!==void 0?e:G.BuiltInSemantics._getSemantics()),r=function(i){if(!(i instanceof Fe))throw new TypeError("Semantics expected a MatchResult, but got "+bt(i));if(i.failed())throw new TypeError("cannot apply Semantics to "+i.toString());let a=i._cst;if(a.grammar!==t)throw new Error("Cannot use a MatchResult from grammar '"+a.grammar.name+"' with a semantics for '"+t.name+"'");let l=new be(i.input);return n.wrap(a,l.interval(i._cstOffset,i.input.length))};return r.addOperation=function(s,i){return n.addOperationOrAttribute("operation",s,i),r},r.extendOperation=function(s,i){return n.extendOperationOrAttribute("operation",s,i),r},r.addAttribute=function(s,i){return n.addOperationOrAttribute("attribute",s,i),r},r.extendAttribute=function(s,i){return n.extendOperationOrAttribute("attribute",s,i),r},r._getActionDict=function(s){let i=n.operations[s]||n.attributes[s];if(!i)throw new Error('"'+s+'" is not a valid operation or attribute name in this semantics for "'+t.name+'"');return i.actionDict},r._remove=function(s){let i;return s in n.operations?(i=n.operations[s],delete n.operations[s]):s in n.attributes&&(i=n.attributes[s],delete n.attributes[s]),delete n.Wrapper.prototype[s],i},r.getOperationNames=function(){return Object.keys(n.operations)},r.getAttributeNames=function(){return Object.keys(n.attributes)},r.getGrammar=function(){return n.grammar},r.toRecipe=function(s){return n.toRecipe(s)},r.toString=n.toString.bind(n),r._getSemantics=function(){return n},r};var me=class{constructor(e,n,r,s){this.name=e,this.formals=n,this.actionDict=r,this.builtInDefault=s}checkActionDict(e){e._checkTopDownActionDict(this.typeName,this.name,this.actionDict)}execute(e,n){try{let{ctorName:r}=n._node,s=this.actionDict[r];return s?(Ce.push([this,r]),s.apply(n,n._children())):n.isNonterminal()&&(s=this.actionDict._nonterminal,s)?(Ce.push([this,"_nonterminal",r]),s.apply(n,n._children())):(Ce.push([this,"default action",r]),this.actionDict._default.apply(n,n._children()))}finally{Ce.pop()}}};me.prototype.typeName="operation";var Te=class extends me{constructor(e,n,r){super(e,[],n,r)}execute(e,n){let r=n._node,s=e.attributeKeys[this.name];return vt(r,s)||(r[s]=me.prototype.execute.call(this,e,n)),r[s]}};Te.prototype.typeName="attribute";var Zt=["_iter","_terminal","_nonterminal","_default"];function Jt(t){return Object.keys(t.rules).sort().map(e=>t.rules[e])}var Tr=t=>t.replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"),gn,yn,U=class t{constructor(e,n,r,s){if(this.name=e,this.superGrammar=n,this.rules=r,s){if(!(s in r))throw new Error("Invalid start rule: '"+s+"' is not a rule in grammar '"+e+"'");this.defaultStartRule=s}this._matchStateInitializer=void 0,this.supportsIncrementalParsing=!0}matcher(){return new yt(this)}isBuiltIn(){return this===t.ProtoBuiltInRules||this===t.BuiltInRules}equals(e){if(this===e)return!0;if(e==null||this.name!==e.name||this.defaultStartRule!==e.defaultStartRule||!(this.superGrammar===e.superGrammar||this.superGrammar.equals(e.superGrammar)))return!1;let n=Jt(this),r=Jt(e);return n.length===r.length&&n.every((s,i)=>s.description===r[i].description&&s.formals.join(",")===r[i].formals.join(",")&&s.body.toString()===r[i].body.toString())}match(e,n){let r=this.matcher();return r.replaceInputRange(0,0,e),r.match(n)}trace(e,n){let r=this.matcher();return r.replaceInputRange(0,0,e),r.trace(n)}createSemantics(){return G.createSemantics(this)}extendSemantics(e){return G.createSemantics(this,e._getSemantics())}_checkTopDownActionDict(e,n,r){let s=[];for(let i in r){let a=r[i];if(!Zt.includes(i)&&!(i in this.rules)){s.push(`'${i}' is not a valid semantic action for '${this.name}'`);continue}if(typeof a!="function"){s.push(`'${i}' must be a function in an action dictionary for '${this.name}'`);continue}let o=a.length,d=this._topDownActionArity(i);if(o!==d){let c;i==="_iter"||i==="_nonterminal"?c=`it should use a rest parameter, e.g. \`${i}(...children) {}\`. NOTE: this is new in Ohm v16 \u2014 see https://ohmjs.org/d/ati for details.`:c=`expected ${d}, got ${o}`,s.push(`Semantic action '${i}' has the wrong arity: ${c}`)}}if(s.length>0){let i=s.map(l=>"- "+l),a=new Error([`Found errors in the action dictionary of the '${n}' ${e}:`,...i].join(`
`));throw a.problems=s,a}}_topDownActionArity(e){return Zt.includes(e)?0:this.rules[e].body.getArity()}_inheritsFrom(e){let n=this.superGrammar;for(;n;){if(n.equals(e,!0))return!0;n=n.superGrammar}return!1}toRecipe(e=void 0){let n={};this.source&&(n.source=this.source.contents);let r=null;this.defaultStartRule&&(r=this.defaultStartRule);let s={};Object.keys(this.rules).forEach(l=>{let o=this.rules[l],{body:d}=o,c=!this.superGrammar||!this.superGrammar.rules[l],u;c?u="define":u=d instanceof he?"extend":"override";let p={};if(o.source&&this.source){let m=o.source.relativeTo(this.source);p.sourceInterval=[m.startIdx,m.endIdx]}let h=c?o.description:null,f=d.outputRecipe(o.formals,this.source);s[l]=[u,p,h,o.formals,f]});let i="null";e?i=e:this.superGrammar&&!this.superGrammar.isBuiltIn()&&(i=this.superGrammar.toRecipe());let a=[...["grammar",n,this.name].map(JSON.stringify),i,...[r,s].map(JSON.stringify)];return Tr(`[${a.join(",")}]`)}toOperationActionDictionaryTemplate(){return this._toOperationOrAttributeActionDictionaryTemplate()}toAttributeActionDictionaryTemplate(){return this._toOperationOrAttributeActionDictionaryTemplate()}_toOperationOrAttributeActionDictionaryTemplate(){let e=new ge;e.append("{");let n=!0;for(let r in this.rules){let{body:s}=this.rules[r];n?n=!1:e.append(","),e.append(`
`),e.append("  "),this.addSemanticActionTemplate(r,s,e)}return e.append(`
}`),e.contents()}addSemanticActionTemplate(e,n,r){r.append(e),r.append(": function(");let s=this._topDownActionArity(e);r.append(ze("_",s).join(", ")),r.append(`) {
`),r.append("  }")}parseApplication(e){let n;if(e.indexOf("<")===-1)n=new b(e);else{let s=gn.match(e,"Base_application");n=yn(s,{})}if(!(n.ruleName in this.rules))throw cn(n.ruleName,this.name);let{formals:r}=this.rules[n.ruleName];if(r.length!==n.args.length){let{source:s}=this.rules[n.ruleName];throw un(n.ruleName,r.length,n.args.length,s)}return n}_setUpMatchState(e){this._matchStateInitializer&&this._matchStateInitializer(e)}};U.ProtoBuiltInRules=new U("ProtoBuiltInRules",void 0,{any:{body:F,formals:[],description:"any character",primitive:!0},end:{body:D,formals:[],description:"end of input",primitive:!0},caseInsensitive:{body:new qe(new R(0)),formals:["str"],primitive:!0},lower:{body:new C("Ll"),formals:[],description:"a lowercase letter",primitive:!0},upper:{body:new C("Lu"),formals:[],description:"an uppercase letter",primitive:!0},unicodeLtmo:{body:new C("Ltmo"),formals:[],description:"a Unicode character in Lt, Lm, or Lo",primitive:!0},spaces:{body:new ee(new b("space")),formals:[]},space:{body:new T("\0"," "),formals:[],description:"a space"}});U.initApplicationParser=function(t,e){gn=t,yn=e};var Ge=class{constructor(e){this.name=e}sourceInterval(e,n){return this.source.subInterval(e,n-e)}ensureSuperGrammar(){return this.superGrammar||this.withSuperGrammar(this.name==="BuiltInRules"?U.ProtoBuiltInRules:U.BuiltInRules),this.superGrammar}ensureSuperGrammarRuleForOverriding(e,n){let r=this.ensureSuperGrammar().rules[e];if(!r)throw tr(e,this.superGrammar.name,n);return r}installOverriddenOrExtendedRule(e,n,r,s){let i=ct(n);if(i.length>0)throw zt(e,i,s);let a=this.ensureSuperGrammar().rules[e],l=a.formals,o=l?l.length:0;if(n.length!==o)throw un(e,o,n.length,s);return this.install(e,n,r,a.description,s)}install(e,n,r,s,i,a=!1){return this.rules[e]={body:r.introduceParams(n),formals:n,description:s,source:i,primitive:a},this}withSuperGrammar(e){if(this.superGrammar)throw new Error("the super grammar of a GrammarDecl cannot be set more than once");return this.superGrammar=e,this.rules=Object.create(e.rules),e.isBuiltIn()||(this.defaultStartRule=e.defaultStartRule),this}withDefaultStartRule(e){return this.defaultStartRule=e,this}withSource(e){return this.source=new be(e).interval(0,e.length),this}build(){let e=new U(this.name,this.ensureSuperGrammar(),this.rules,this.defaultStartRule);e._matchStateInitializer=e.superGrammar._matchStateInitializer,e.supportsIncrementalParsing=e.superGrammar.supportsIncrementalParsing;let n=[],r=!1;return Object.keys(e.rules).forEach(s=>{let{body:i}=e.rules[s];try{i.assertChoicesHaveUniformArity(s)}catch(a){n.push(a)}try{i.assertAllApplicationsAreValid(s,e)}catch(a){n.push(a),r=!0}}),r||Object.keys(e.rules).forEach(s=>{let{body:i}=e.rules[s];try{i.assertIteratedExprsAreNotNullable(e,[])}catch(a){n.push(a)}}),n.length>0&&dr(n),this.source&&(e.source=this.source),e}define(e,n,r,s,i,a){if(this.ensureSuperGrammar(),this.superGrammar.rules[e])throw Ut(e,this.name,this.superGrammar.name,i);if(this.rules[e])throw Ut(e,this.name,this.name,i);let l=ct(n);if(l.length>0)throw zt(e,l,i);return this.install(e,n,r,s,i,a)}override(e,n,r,s,i){return this.ensureSuperGrammarRuleForOverriding(e,i),this.installOverriddenOrExtendedRule(e,n,r,i),this}extend(e,n,r,s,i){if(!this.ensureSuperGrammar().rules[e])throw nr(e,this.superGrammar.name,i);let l=new he(this.superGrammar,e,r);return l.source=r.source,this.installOverriddenOrExtendedRule(e,n,l,i),this}},_e=class{constructor(){this.currentDecl=null,this.currentRuleName=null}newGrammar(e){return new Ge(e)}grammar(e,n,r,s,i){let a=new Ge(n);return r&&a.withSuperGrammar(r instanceof U?r:this.fromRecipe(r)),s&&a.withDefaultStartRule(s),e&&e.source&&a.withSource(e.source),this.currentDecl=a,Object.keys(i).forEach(l=>{this.currentRuleName=l;let o=i[l],d=o[0],c=o[1],u=o[2],p=o[3],h=this.fromRecipe(o[4]),f;a.source&&c&&c.sourceInterval&&(f=a.source.subInterval(c.sourceInterval[0],c.sourceInterval[1]-c.sourceInterval[0])),a[d](l,p,h,u,f)}),this.currentRuleName=this.currentDecl=null,a.build()}terminal(e){return new L(e)}range(e,n){return new T(e,n)}param(e){return new R(e)}alt(...e){let n=[];for(let r of e)r instanceof I||(r=this.fromRecipe(r)),r instanceof S?n=n.concat(r.terms):n.push(r);return n.length===1?n[0]:new S(n)}seq(...e){let n=[];for(let r of e)r instanceof I||(r=this.fromRecipe(r)),r instanceof O?n=n.concat(r.factors):n.push(r);return n.length===1?n[0]:new O(n)}star(e){return e instanceof I||(e=this.fromRecipe(e)),new ee(e)}plus(e){return e instanceof I||(e=this.fromRecipe(e)),new ie(e)}opt(e){return e instanceof I||(e=this.fromRecipe(e)),new Q(e)}not(e){return e instanceof I||(e=this.fromRecipe(e)),new P(e)}lookahead(e){return e instanceof I||(e=this.fromRecipe(e)),new $(e)}lex(e){return e instanceof I||(e=this.fromRecipe(e)),new M(e)}app(e,n){return n&&n.length>0&&(n=n.map(function(r){return r instanceof I?r:this.fromRecipe(r)},this)),new b(e,n)}splice(e,n){return new de(this.currentDecl.superGrammar,this.currentRuleName,e.map(r=>this.fromRecipe(r)),n.map(r=>this.fromRecipe(r)))}fromRecipe(e){let n=e[0]==="grammar"?e.slice(1):e.slice(2),r=this[e[0]](...n),s=e[1];return s&&s.sourceInterval&&this.currentDecl&&r.withSource(this.currentDecl.sourceInterval(...s.sourceInterval)),r}};function Ve(t){return typeof t=="function"?t.call(new _e):(typeof t=="string"&&(t=JSON.parse(t)),new _e().fromRecipe(t))}var wt=Ve(["grammar",{source:`BuiltInRules {

  alnum  (an alpha-numeric character)
    = letter
    | digit

  letter  (a letter)
    = lower
    | upper
    | unicodeLtmo

  digit  (a digit)
    = "0".."9"

  hexDigit  (a hexadecimal digit)
    = digit
    | "a".."f"
    | "A".."F"

  ListOf<elem, sep>
    = NonemptyListOf<elem, sep>
    | EmptyListOf<elem, sep>

  NonemptyListOf<elem, sep>
    = elem (sep elem)*

  EmptyListOf<elem, sep>
    = /* nothing */

  listOf<elem, sep>
    = nonemptyListOf<elem, sep>
    | emptyListOf<elem, sep>

  nonemptyListOf<elem, sep>
    = elem (sep elem)*

  emptyListOf<elem, sep>
    = /* nothing */

  // Allows a syntactic rule application within a lexical context.
  applySyntactic<app> = app
}`},"BuiltInRules",null,null,{alnum:["define",{sourceInterval:[18,78]},"an alpha-numeric character",[],["alt",{sourceInterval:[60,78]},["app",{sourceInterval:[60,66]},"letter",[]],["app",{sourceInterval:[73,78]},"digit",[]]]],letter:["define",{sourceInterval:[82,142]},"a letter",[],["alt",{sourceInterval:[107,142]},["app",{sourceInterval:[107,112]},"lower",[]],["app",{sourceInterval:[119,124]},"upper",[]],["app",{sourceInterval:[131,142]},"unicodeLtmo",[]]]],digit:["define",{sourceInterval:[146,177]},"a digit",[],["range",{sourceInterval:[169,177]},"0","9"]],hexDigit:["define",{sourceInterval:[181,254]},"a hexadecimal digit",[],["alt",{sourceInterval:[219,254]},["app",{sourceInterval:[219,224]},"digit",[]],["range",{sourceInterval:[231,239]},"a","f"],["range",{sourceInterval:[246,254]},"A","F"]]],ListOf:["define",{sourceInterval:[258,336]},null,["elem","sep"],["alt",{sourceInterval:[282,336]},["app",{sourceInterval:[282,307]},"NonemptyListOf",[["param",{sourceInterval:[297,301]},0],["param",{sourceInterval:[303,306]},1]]],["app",{sourceInterval:[314,336]},"EmptyListOf",[["param",{sourceInterval:[326,330]},0],["param",{sourceInterval:[332,335]},1]]]]],NonemptyListOf:["define",{sourceInterval:[340,388]},null,["elem","sep"],["seq",{sourceInterval:[372,388]},["param",{sourceInterval:[372,376]},0],["star",{sourceInterval:[377,388]},["seq",{sourceInterval:[378,386]},["param",{sourceInterval:[378,381]},1],["param",{sourceInterval:[382,386]},0]]]]],EmptyListOf:["define",{sourceInterval:[392,434]},null,["elem","sep"],["seq",{sourceInterval:[438,438]}]],listOf:["define",{sourceInterval:[438,516]},null,["elem","sep"],["alt",{sourceInterval:[462,516]},["app",{sourceInterval:[462,487]},"nonemptyListOf",[["param",{sourceInterval:[477,481]},0],["param",{sourceInterval:[483,486]},1]]],["app",{sourceInterval:[494,516]},"emptyListOf",[["param",{sourceInterval:[506,510]},0],["param",{sourceInterval:[512,515]},1]]]]],nonemptyListOf:["define",{sourceInterval:[520,568]},null,["elem","sep"],["seq",{sourceInterval:[552,568]},["param",{sourceInterval:[552,556]},0],["star",{sourceInterval:[557,568]},["seq",{sourceInterval:[558,566]},["param",{sourceInterval:[558,561]},1],["param",{sourceInterval:[562,566]},0]]]]],emptyListOf:["define",{sourceInterval:[572,682]},null,["elem","sep"],["seq",{sourceInterval:[685,685]}]],applySyntactic:["define",{sourceInterval:[685,710]},null,["app"],["param",{sourceInterval:[707,710]},0]]}]);U.BuiltInRules=wt;gr(U.BuiltInRules);var He=Ve(["grammar",{source:`Ohm {

  Grammars
    = Grammar*

  Grammar
    = ident SuperGrammar? "{" Rule* "}"

  SuperGrammar
    = "<:" ident

  Rule
    = ident Formals? ruleDescr? "="  RuleBody  -- define
    | ident Formals?            ":=" OverrideRuleBody  -- override
    | ident Formals?            "+=" RuleBody  -- extend

  RuleBody
    = "|"? NonemptyListOf<TopLevelTerm, "|">

  TopLevelTerm
    = Seq caseName  -- inline
    | Seq

  OverrideRuleBody
    = "|"? NonemptyListOf<OverrideTopLevelTerm, "|">

  OverrideTopLevelTerm
    = "..."  -- superSplice
    | TopLevelTerm

  Formals
    = "<" ListOf<ident, ","> ">"

  Params
    = "<" ListOf<Seq, ","> ">"

  Alt
    = NonemptyListOf<Seq, "|">

  Seq
    = Iter*

  Iter
    = Pred "*"  -- star
    | Pred "+"  -- plus
    | Pred "?"  -- opt
    | Pred

  Pred
    = "~" Lex  -- not
    | "&" Lex  -- lookahead
    | Lex

  Lex
    = "#" Base  -- lex
    | Base

  Base
    = ident Params? ~(ruleDescr? "=" | ":=" | "+=")  -- application
    | oneCharTerminal ".." oneCharTerminal           -- range
    | terminal                                       -- terminal
    | "(" Alt ")"                                    -- paren

  ruleDescr  (a rule description)
    = "(" ruleDescrText ")"

  ruleDescrText
    = (~")" any)*

  caseName
    = "--" (~"\\n" space)* name (~"\\n" space)* ("\\n" | &"}")

  name  (a name)
    = nameFirst nameRest*

  nameFirst
    = "_"
    | letter

  nameRest
    = "_"
    | alnum

  ident  (an identifier)
    = name

  terminal
    = "\\"" terminalChar* "\\""

  oneCharTerminal
    = "\\"" terminalChar "\\""

  terminalChar
    = escapeChar
      | ~"\\\\" ~"\\"" ~"\\n" "\\u{0}".."\\u{10FFFF}"

  escapeChar  (an escape sequence)
    = "\\\\\\\\"                                     -- backslash
    | "\\\\\\""                                     -- doubleQuote
    | "\\\\\\'"                                     -- singleQuote
    | "\\\\b"                                      -- backspace
    | "\\\\n"                                      -- lineFeed
    | "\\\\r"                                      -- carriageReturn
    | "\\\\t"                                      -- tab
    | "\\\\u{" hexDigit hexDigit? hexDigit?
             hexDigit? hexDigit? hexDigit? "}"   -- unicodeCodePoint
    | "\\\\u" hexDigit hexDigit hexDigit hexDigit  -- unicodeEscape
    | "\\\\x" hexDigit hexDigit                    -- hexEscape

  space
   += comment

  comment
    = "//" (~"\\n" any)* &("\\n" | end)  -- singleLine
    | "/*" (~"*/" any)* "*/"  -- multiLine

  tokens = token*

  token = caseName | comment | ident | operator | punctuation | terminal | any

  operator = "<:" | "=" | ":=" | "+=" | "*" | "+" | "?" | "~" | "&"

  punctuation = "<" | ">" | "," | "--"
}`},"Ohm",null,"Grammars",{Grammars:["define",{sourceInterval:[9,32]},null,[],["star",{sourceInterval:[24,32]},["app",{sourceInterval:[24,31]},"Grammar",[]]]],Grammar:["define",{sourceInterval:[36,83]},null,[],["seq",{sourceInterval:[50,83]},["app",{sourceInterval:[50,55]},"ident",[]],["opt",{sourceInterval:[56,69]},["app",{sourceInterval:[56,68]},"SuperGrammar",[]]],["terminal",{sourceInterval:[70,73]},"{"],["star",{sourceInterval:[74,79]},["app",{sourceInterval:[74,78]},"Rule",[]]],["terminal",{sourceInterval:[80,83]},"}"]]],SuperGrammar:["define",{sourceInterval:[87,116]},null,[],["seq",{sourceInterval:[106,116]},["terminal",{sourceInterval:[106,110]},"<:"],["app",{sourceInterval:[111,116]},"ident",[]]]],Rule_define:["define",{sourceInterval:[131,181]},null,[],["seq",{sourceInterval:[131,170]},["app",{sourceInterval:[131,136]},"ident",[]],["opt",{sourceInterval:[137,145]},["app",{sourceInterval:[137,144]},"Formals",[]]],["opt",{sourceInterval:[146,156]},["app",{sourceInterval:[146,155]},"ruleDescr",[]]],["terminal",{sourceInterval:[157,160]},"="],["app",{sourceInterval:[162,170]},"RuleBody",[]]]],Rule_override:["define",{sourceInterval:[188,248]},null,[],["seq",{sourceInterval:[188,235]},["app",{sourceInterval:[188,193]},"ident",[]],["opt",{sourceInterval:[194,202]},["app",{sourceInterval:[194,201]},"Formals",[]]],["terminal",{sourceInterval:[214,218]},":="],["app",{sourceInterval:[219,235]},"OverrideRuleBody",[]]]],Rule_extend:["define",{sourceInterval:[255,305]},null,[],["seq",{sourceInterval:[255,294]},["app",{sourceInterval:[255,260]},"ident",[]],["opt",{sourceInterval:[261,269]},["app",{sourceInterval:[261,268]},"Formals",[]]],["terminal",{sourceInterval:[281,285]},"+="],["app",{sourceInterval:[286,294]},"RuleBody",[]]]],Rule:["define",{sourceInterval:[120,305]},null,[],["alt",{sourceInterval:[131,305]},["app",{sourceInterval:[131,170]},"Rule_define",[]],["app",{sourceInterval:[188,235]},"Rule_override",[]],["app",{sourceInterval:[255,294]},"Rule_extend",[]]]],RuleBody:["define",{sourceInterval:[309,362]},null,[],["seq",{sourceInterval:[324,362]},["opt",{sourceInterval:[324,328]},["terminal",{sourceInterval:[324,327]},"|"]],["app",{sourceInterval:[329,362]},"NonemptyListOf",[["app",{sourceInterval:[344,356]},"TopLevelTerm",[]],["terminal",{sourceInterval:[358,361]},"|"]]]]],TopLevelTerm_inline:["define",{sourceInterval:[385,408]},null,[],["seq",{sourceInterval:[385,397]},["app",{sourceInterval:[385,388]},"Seq",[]],["app",{sourceInterval:[389,397]},"caseName",[]]]],TopLevelTerm:["define",{sourceInterval:[366,418]},null,[],["alt",{sourceInterval:[385,418]},["app",{sourceInterval:[385,397]},"TopLevelTerm_inline",[]],["app",{sourceInterval:[415,418]},"Seq",[]]]],OverrideRuleBody:["define",{sourceInterval:[422,491]},null,[],["seq",{sourceInterval:[445,491]},["opt",{sourceInterval:[445,449]},["terminal",{sourceInterval:[445,448]},"|"]],["app",{sourceInterval:[450,491]},"NonemptyListOf",[["app",{sourceInterval:[465,485]},"OverrideTopLevelTerm",[]],["terminal",{sourceInterval:[487,490]},"|"]]]]],OverrideTopLevelTerm_superSplice:["define",{sourceInterval:[522,543]},null,[],["terminal",{sourceInterval:[522,527]},"..."]],OverrideTopLevelTerm:["define",{sourceInterval:[495,562]},null,[],["alt",{sourceInterval:[522,562]},["app",{sourceInterval:[522,527]},"OverrideTopLevelTerm_superSplice",[]],["app",{sourceInterval:[550,562]},"TopLevelTerm",[]]]],Formals:["define",{sourceInterval:[566,606]},null,[],["seq",{sourceInterval:[580,606]},["terminal",{sourceInterval:[580,583]},"<"],["app",{sourceInterval:[584,602]},"ListOf",[["app",{sourceInterval:[591,596]},"ident",[]],["terminal",{sourceInterval:[598,601]},","]]],["terminal",{sourceInterval:[603,606]},">"]]],Params:["define",{sourceInterval:[610,647]},null,[],["seq",{sourceInterval:[623,647]},["terminal",{sourceInterval:[623,626]},"<"],["app",{sourceInterval:[627,643]},"ListOf",[["app",{sourceInterval:[634,637]},"Seq",[]],["terminal",{sourceInterval:[639,642]},","]]],["terminal",{sourceInterval:[644,647]},">"]]],Alt:["define",{sourceInterval:[651,685]},null,[],["app",{sourceInterval:[661,685]},"NonemptyListOf",[["app",{sourceInterval:[676,679]},"Seq",[]],["terminal",{sourceInterval:[681,684]},"|"]]]],Seq:["define",{sourceInterval:[689,704]},null,[],["star",{sourceInterval:[699,704]},["app",{sourceInterval:[699,703]},"Iter",[]]]],Iter_star:["define",{sourceInterval:[719,736]},null,[],["seq",{sourceInterval:[719,727]},["app",{sourceInterval:[719,723]},"Pred",[]],["terminal",{sourceInterval:[724,727]},"*"]]],Iter_plus:["define",{sourceInterval:[743,760]},null,[],["seq",{sourceInterval:[743,751]},["app",{sourceInterval:[743,747]},"Pred",[]],["terminal",{sourceInterval:[748,751]},"+"]]],Iter_opt:["define",{sourceInterval:[767,783]},null,[],["seq",{sourceInterval:[767,775]},["app",{sourceInterval:[767,771]},"Pred",[]],["terminal",{sourceInterval:[772,775]},"?"]]],Iter:["define",{sourceInterval:[708,794]},null,[],["alt",{sourceInterval:[719,794]},["app",{sourceInterval:[719,727]},"Iter_star",[]],["app",{sourceInterval:[743,751]},"Iter_plus",[]],["app",{sourceInterval:[767,775]},"Iter_opt",[]],["app",{sourceInterval:[790,794]},"Pred",[]]]],Pred_not:["define",{sourceInterval:[809,824]},null,[],["seq",{sourceInterval:[809,816]},["terminal",{sourceInterval:[809,812]},"~"],["app",{sourceInterval:[813,816]},"Lex",[]]]],Pred_lookahead:["define",{sourceInterval:[831,852]},null,[],["seq",{sourceInterval:[831,838]},["terminal",{sourceInterval:[831,834]},"&"],["app",{sourceInterval:[835,838]},"Lex",[]]]],Pred:["define",{sourceInterval:[798,862]},null,[],["alt",{sourceInterval:[809,862]},["app",{sourceInterval:[809,816]},"Pred_not",[]],["app",{sourceInterval:[831,838]},"Pred_lookahead",[]],["app",{sourceInterval:[859,862]},"Lex",[]]]],Lex_lex:["define",{sourceInterval:[876,892]},null,[],["seq",{sourceInterval:[876,884]},["terminal",{sourceInterval:[876,879]},"#"],["app",{sourceInterval:[880,884]},"Base",[]]]],Lex:["define",{sourceInterval:[866,903]},null,[],["alt",{sourceInterval:[876,903]},["app",{sourceInterval:[876,884]},"Lex_lex",[]],["app",{sourceInterval:[899,903]},"Base",[]]]],Base_application:["define",{sourceInterval:[918,979]},null,[],["seq",{sourceInterval:[918,963]},["app",{sourceInterval:[918,923]},"ident",[]],["opt",{sourceInterval:[924,931]},["app",{sourceInterval:[924,930]},"Params",[]]],["not",{sourceInterval:[932,963]},["alt",{sourceInterval:[934,962]},["seq",{sourceInterval:[934,948]},["opt",{sourceInterval:[934,944]},["app",{sourceInterval:[934,943]},"ruleDescr",[]]],["terminal",{sourceInterval:[945,948]},"="]],["terminal",{sourceInterval:[951,955]},":="],["terminal",{sourceInterval:[958,962]},"+="]]]]],Base_range:["define",{sourceInterval:[986,1041]},null,[],["seq",{sourceInterval:[986,1022]},["app",{sourceInterval:[986,1001]},"oneCharTerminal",[]],["terminal",{sourceInterval:[1002,1006]},".."],["app",{sourceInterval:[1007,1022]},"oneCharTerminal",[]]]],Base_terminal:["define",{sourceInterval:[1048,1106]},null,[],["app",{sourceInterval:[1048,1056]},"terminal",[]]],Base_paren:["define",{sourceInterval:[1113,1168]},null,[],["seq",{sourceInterval:[1113,1124]},["terminal",{sourceInterval:[1113,1116]},"("],["app",{sourceInterval:[1117,1120]},"Alt",[]],["terminal",{sourceInterval:[1121,1124]},")"]]],Base:["define",{sourceInterval:[907,1168]},null,[],["alt",{sourceInterval:[918,1168]},["app",{sourceInterval:[918,963]},"Base_application",[]],["app",{sourceInterval:[986,1022]},"Base_range",[]],["app",{sourceInterval:[1048,1056]},"Base_terminal",[]],["app",{sourceInterval:[1113,1124]},"Base_paren",[]]]],ruleDescr:["define",{sourceInterval:[1172,1231]},"a rule description",[],["seq",{sourceInterval:[1210,1231]},["terminal",{sourceInterval:[1210,1213]},"("],["app",{sourceInterval:[1214,1227]},"ruleDescrText",[]],["terminal",{sourceInterval:[1228,1231]},")"]]],ruleDescrText:["define",{sourceInterval:[1235,1266]},null,[],["star",{sourceInterval:[1255,1266]},["seq",{sourceInterval:[1256,1264]},["not",{sourceInterval:[1256,1260]},["terminal",{sourceInterval:[1257,1260]},")"]],["app",{sourceInterval:[1261,1264]},"any",[]]]]],caseName:["define",{sourceInterval:[1270,1338]},null,[],["seq",{sourceInterval:[1285,1338]},["terminal",{sourceInterval:[1285,1289]},"--"],["star",{sourceInterval:[1290,1304]},["seq",{sourceInterval:[1291,1302]},["not",{sourceInterval:[1291,1296]},["terminal",{sourceInterval:[1292,1296]},`
`]],["app",{sourceInterval:[1297,1302]},"space",[]]]],["app",{sourceInterval:[1305,1309]},"name",[]],["star",{sourceInterval:[1310,1324]},["seq",{sourceInterval:[1311,1322]},["not",{sourceInterval:[1311,1316]},["terminal",{sourceInterval:[1312,1316]},`
`]],["app",{sourceInterval:[1317,1322]},"space",[]]]],["alt",{sourceInterval:[1326,1337]},["terminal",{sourceInterval:[1326,1330]},`
`],["lookahead",{sourceInterval:[1333,1337]},["terminal",{sourceInterval:[1334,1337]},"}"]]]]],name:["define",{sourceInterval:[1342,1382]},"a name",[],["seq",{sourceInterval:[1363,1382]},["app",{sourceInterval:[1363,1372]},"nameFirst",[]],["star",{sourceInterval:[1373,1382]},["app",{sourceInterval:[1373,1381]},"nameRest",[]]]]],nameFirst:["define",{sourceInterval:[1386,1418]},null,[],["alt",{sourceInterval:[1402,1418]},["terminal",{sourceInterval:[1402,1405]},"_"],["app",{sourceInterval:[1412,1418]},"letter",[]]]],nameRest:["define",{sourceInterval:[1422,1452]},null,[],["alt",{sourceInterval:[1437,1452]},["terminal",{sourceInterval:[1437,1440]},"_"],["app",{sourceInterval:[1447,1452]},"alnum",[]]]],ident:["define",{sourceInterval:[1456,1489]},"an identifier",[],["app",{sourceInterval:[1485,1489]},"name",[]]],terminal:["define",{sourceInterval:[1493,1531]},null,[],["seq",{sourceInterval:[1508,1531]},["terminal",{sourceInterval:[1508,1512]},'"'],["star",{sourceInterval:[1513,1526]},["app",{sourceInterval:[1513,1525]},"terminalChar",[]]],["terminal",{sourceInterval:[1527,1531]},'"']]],oneCharTerminal:["define",{sourceInterval:[1535,1579]},null,[],["seq",{sourceInterval:[1557,1579]},["terminal",{sourceInterval:[1557,1561]},'"'],["app",{sourceInterval:[1562,1574]},"terminalChar",[]],["terminal",{sourceInterval:[1575,1579]},'"']]],terminalChar:["define",{sourceInterval:[1583,1660]},null,[],["alt",{sourceInterval:[1602,1660]},["app",{sourceInterval:[1602,1612]},"escapeChar",[]],["seq",{sourceInterval:[1621,1660]},["not",{sourceInterval:[1621,1626]},["terminal",{sourceInterval:[1622,1626]},"\\"]],["not",{sourceInterval:[1627,1632]},["terminal",{sourceInterval:[1628,1632]},'"']],["not",{sourceInterval:[1633,1638]},["terminal",{sourceInterval:[1634,1638]},`
`]],["range",{sourceInterval:[1639,1660]},"\0","\u{10FFFF}"]]]],escapeChar_backslash:["define",{sourceInterval:[1703,1758]},null,[],["terminal",{sourceInterval:[1703,1709]},"\\\\"]],escapeChar_doubleQuote:["define",{sourceInterval:[1765,1822]},null,[],["terminal",{sourceInterval:[1765,1771]},'\\"']],escapeChar_singleQuote:["define",{sourceInterval:[1829,1886]},null,[],["terminal",{sourceInterval:[1829,1835]},"\\'"]],escapeChar_backspace:["define",{sourceInterval:[1893,1948]},null,[],["terminal",{sourceInterval:[1893,1898]},"\\b"]],escapeChar_lineFeed:["define",{sourceInterval:[1955,2009]},null,[],["terminal",{sourceInterval:[1955,1960]},"\\n"]],escapeChar_carriageReturn:["define",{sourceInterval:[2016,2076]},null,[],["terminal",{sourceInterval:[2016,2021]},"\\r"]],escapeChar_tab:["define",{sourceInterval:[2083,2132]},null,[],["terminal",{sourceInterval:[2083,2088]},"\\t"]],escapeChar_unicodeCodePoint:["define",{sourceInterval:[2139,2243]},null,[],["seq",{sourceInterval:[2139,2221]},["terminal",{sourceInterval:[2139,2145]},"\\u{"],["app",{sourceInterval:[2146,2154]},"hexDigit",[]],["opt",{sourceInterval:[2155,2164]},["app",{sourceInterval:[2155,2163]},"hexDigit",[]]],["opt",{sourceInterval:[2165,2174]},["app",{sourceInterval:[2165,2173]},"hexDigit",[]]],["opt",{sourceInterval:[2188,2197]},["app",{sourceInterval:[2188,2196]},"hexDigit",[]]],["opt",{sourceInterval:[2198,2207]},["app",{sourceInterval:[2198,2206]},"hexDigit",[]]],["opt",{sourceInterval:[2208,2217]},["app",{sourceInterval:[2208,2216]},"hexDigit",[]]],["terminal",{sourceInterval:[2218,2221]},"}"]]],escapeChar_unicodeEscape:["define",{sourceInterval:[2250,2309]},null,[],["seq",{sourceInterval:[2250,2291]},["terminal",{sourceInterval:[2250,2255]},"\\u"],["app",{sourceInterval:[2256,2264]},"hexDigit",[]],["app",{sourceInterval:[2265,2273]},"hexDigit",[]],["app",{sourceInterval:[2274,2282]},"hexDigit",[]],["app",{sourceInterval:[2283,2291]},"hexDigit",[]]]],escapeChar_hexEscape:["define",{sourceInterval:[2316,2371]},null,[],["seq",{sourceInterval:[2316,2339]},["terminal",{sourceInterval:[2316,2321]},"\\x"],["app",{sourceInterval:[2322,2330]},"hexDigit",[]],["app",{sourceInterval:[2331,2339]},"hexDigit",[]]]],escapeChar:["define",{sourceInterval:[1664,2371]},"an escape sequence",[],["alt",{sourceInterval:[1703,2371]},["app",{sourceInterval:[1703,1709]},"escapeChar_backslash",[]],["app",{sourceInterval:[1765,1771]},"escapeChar_doubleQuote",[]],["app",{sourceInterval:[1829,1835]},"escapeChar_singleQuote",[]],["app",{sourceInterval:[1893,1898]},"escapeChar_backspace",[]],["app",{sourceInterval:[1955,1960]},"escapeChar_lineFeed",[]],["app",{sourceInterval:[2016,2021]},"escapeChar_carriageReturn",[]],["app",{sourceInterval:[2083,2088]},"escapeChar_tab",[]],["app",{sourceInterval:[2139,2221]},"escapeChar_unicodeCodePoint",[]],["app",{sourceInterval:[2250,2291]},"escapeChar_unicodeEscape",[]],["app",{sourceInterval:[2316,2339]},"escapeChar_hexEscape",[]]]],space:["extend",{sourceInterval:[2375,2394]},null,[],["app",{sourceInterval:[2387,2394]},"comment",[]]],comment_singleLine:["define",{sourceInterval:[2412,2458]},null,[],["seq",{sourceInterval:[2412,2443]},["terminal",{sourceInterval:[2412,2416]},"//"],["star",{sourceInterval:[2417,2429]},["seq",{sourceInterval:[2418,2427]},["not",{sourceInterval:[2418,2423]},["terminal",{sourceInterval:[2419,2423]},`
`]],["app",{sourceInterval:[2424,2427]},"any",[]]]],["lookahead",{sourceInterval:[2430,2443]},["alt",{sourceInterval:[2432,2442]},["terminal",{sourceInterval:[2432,2436]},`
`],["app",{sourceInterval:[2439,2442]},"end",[]]]]]],comment_multiLine:["define",{sourceInterval:[2465,2501]},null,[],["seq",{sourceInterval:[2465,2487]},["terminal",{sourceInterval:[2465,2469]},"/*"],["star",{sourceInterval:[2470,2482]},["seq",{sourceInterval:[2471,2480]},["not",{sourceInterval:[2471,2476]},["terminal",{sourceInterval:[2472,2476]},"*/"]],["app",{sourceInterval:[2477,2480]},"any",[]]]],["terminal",{sourceInterval:[2483,2487]},"*/"]]],comment:["define",{sourceInterval:[2398,2501]},null,[],["alt",{sourceInterval:[2412,2501]},["app",{sourceInterval:[2412,2443]},"comment_singleLine",[]],["app",{sourceInterval:[2465,2487]},"comment_multiLine",[]]]],tokens:["define",{sourceInterval:[2505,2520]},null,[],["star",{sourceInterval:[2514,2520]},["app",{sourceInterval:[2514,2519]},"token",[]]]],token:["define",{sourceInterval:[2524,2600]},null,[],["alt",{sourceInterval:[2532,2600]},["app",{sourceInterval:[2532,2540]},"caseName",[]],["app",{sourceInterval:[2543,2550]},"comment",[]],["app",{sourceInterval:[2553,2558]},"ident",[]],["app",{sourceInterval:[2561,2569]},"operator",[]],["app",{sourceInterval:[2572,2583]},"punctuation",[]],["app",{sourceInterval:[2586,2594]},"terminal",[]],["app",{sourceInterval:[2597,2600]},"any",[]]]],operator:["define",{sourceInterval:[2604,2669]},null,[],["alt",{sourceInterval:[2615,2669]},["terminal",{sourceInterval:[2615,2619]},"<:"],["terminal",{sourceInterval:[2622,2625]},"="],["terminal",{sourceInterval:[2628,2632]},":="],["terminal",{sourceInterval:[2635,2639]},"+="],["terminal",{sourceInterval:[2642,2645]},"*"],["terminal",{sourceInterval:[2648,2651]},"+"],["terminal",{sourceInterval:[2654,2657]},"?"],["terminal",{sourceInterval:[2660,2663]},"~"],["terminal",{sourceInterval:[2666,2669]},"&"]]],punctuation:["define",{sourceInterval:[2673,2709]},null,[],["alt",{sourceInterval:[2687,2709]},["terminal",{sourceInterval:[2687,2690]},"<"],["terminal",{sourceInterval:[2693,2696]},">"],["terminal",{sourceInterval:[2699,2702]},","],["terminal",{sourceInterval:[2705,2709]},"--"]]]}]),ot=Object.create(I.prototype);function Yt(t,e){for(let n in t)if(n===e)return!0;return!1}function At(t,e,n){let r=new _e,s,i,a,l=!1;return(n||He).createSemantics().addOperation("visit",{Grammars(c){return c.children.map(u=>u.visit())},Grammar(c,u,p,h,f){let m=c.visit();s=r.newGrammar(m),u.child(0)&&u.child(0).visit(),h.children.map(g=>g.visit());let y=s.build();if(y.source=this.source.trimmed(),Yt(e,m))throw Xn(y);return e[m]=y,y},SuperGrammar(c,u){let p=u.visit();if(p==="null")s.withSuperGrammar(null);else{if(!e||!Yt(e,p))throw Yn(p,e,u.source);s.withSuperGrammar(e[p])}},Rule_define(c,u,p,h,f){i=c.visit(),a=u.children.map(v=>v.visit())[0]||[],!s.defaultStartRule&&s.ensureSuperGrammar()!==U.ProtoBuiltInRules&&s.withDefaultStartRule(i);let m=f.visit(),y=p.children.map(v=>v.visit())[0],g=this.source.trimmed();return s.define(i,a,m,y,g)},Rule_override(c,u,p,h){i=c.visit(),a=u.children.map(y=>y.visit())[0]||[];let f=this.source.trimmed();s.ensureSuperGrammarRuleForOverriding(i,f),l=!0;let m=h.visit();return l=!1,s.override(i,a,m,null,f)},Rule_extend(c,u,p,h){i=c.visit(),a=u.children.map(y=>y.visit())[0]||[];let f=h.visit(),m=this.source.trimmed();return s.extend(i,a,f,null,m)},RuleBody(c,u){return r.alt(...u.visit()).withSource(this.source)},OverrideRuleBody(c,u){let p=u.visit(),h=p.indexOf(ot);if(h>=0){let f=p.slice(0,h),m=p.slice(h+1);return m.forEach(y=>{if(y===ot)throw cr(y)}),new de(s.superGrammar,i,f,m).withSource(this.source)}else return r.alt(...p).withSource(this.source)},Formals(c,u,p){return u.visit()},Params(c,u,p){return u.visit()},Alt(c){return r.alt(...c.visit()).withSource(this.source)},TopLevelTerm_inline(c,u){let p=i+"_"+u.visit(),h=c.visit(),f=this.source.trimmed(),m=!(s.superGrammar&&s.superGrammar.rules[p]);l&&!m?s.override(p,a,h,null,f):s.define(p,a,h,null,f);let y=a.map(g=>r.app(g));return r.app(p,y).withSource(h.source)},OverrideTopLevelTerm_superSplice(c){return ot},Seq(c){return r.seq(...c.children.map(u=>u.visit())).withSource(this.source)},Iter_star(c,u){return r.star(c.visit()).withSource(this.source)},Iter_plus(c,u){return r.plus(c.visit()).withSource(this.source)},Iter_opt(c,u){return r.opt(c.visit()).withSource(this.source)},Pred_not(c,u){return r.not(u.visit()).withSource(this.source)},Pred_lookahead(c,u){return r.lookahead(u.visit()).withSource(this.source)},Lex_lex(c,u){return r.lex(u.visit()).withSource(this.source)},Base_application(c,u){let p=u.children.map(h=>h.visit())[0]||[];return r.app(c.visit(),p).withSource(this.source)},Base_range(c,u,p){return r.range(c.visit(),p.visit()).withSource(this.source)},Base_terminal(c){return r.terminal(c.visit()).withSource(this.source)},Base_paren(c,u,p){return u.visit()},ruleDescr(c,u,p){return u.visit()},ruleDescrText(c){return this.sourceString.trim()},caseName(c,u,p,h,f){return p.visit()},name(c,u){return this.sourceString},nameFirst(c){},nameRest(c){},terminal(c,u,p){return u.children.map(h=>h.visit()).join("")},oneCharTerminal(c,u,p){return u.visit()},escapeChar(c){try{return an(this.sourceString)}catch(u){throw u instanceof RangeError&&u.message.startsWith("Invalid code point ")?ur(c):u}},NonemptyListOf(c,u,p){return[c.visit()].concat(p.children.map(h=>h.visit()))},EmptyListOf(){return[]},_terminal(){return this.sourceString}})(t).visit()}var Rr=Ve(["grammar",{source:`OperationsAndAttributes {

  AttributeSignature =
    name

  OperationSignature =
    name Formals?

  Formals
    = "(" ListOf<name, ","> ")"

  name  (a name)
    = nameFirst nameRest*

  nameFirst
    = "_"
    | letter

  nameRest
    = "_"
    | alnum

}`},"OperationsAndAttributes",null,"AttributeSignature",{AttributeSignature:["define",{sourceInterval:[29,58]},null,[],["app",{sourceInterval:[54,58]},"name",[]]],OperationSignature:["define",{sourceInterval:[62,100]},null,[],["seq",{sourceInterval:[87,100]},["app",{sourceInterval:[87,91]},"name",[]],["opt",{sourceInterval:[92,100]},["app",{sourceInterval:[92,99]},"Formals",[]]]]],Formals:["define",{sourceInterval:[104,143]},null,[],["seq",{sourceInterval:[118,143]},["terminal",{sourceInterval:[118,121]},"("],["app",{sourceInterval:[122,139]},"ListOf",[["app",{sourceInterval:[129,133]},"name",[]],["terminal",{sourceInterval:[135,138]},","]]],["terminal",{sourceInterval:[140,143]},")"]]],name:["define",{sourceInterval:[147,187]},"a name",[],["seq",{sourceInterval:[168,187]},["app",{sourceInterval:[168,177]},"nameFirst",[]],["star",{sourceInterval:[178,187]},["app",{sourceInterval:[178,186]},"nameRest",[]]]]],nameFirst:["define",{sourceInterval:[191,223]},null,[],["alt",{sourceInterval:[207,223]},["terminal",{sourceInterval:[207,210]},"_"],["app",{sourceInterval:[217,223]},"letter",[]]]],nameRest:["define",{sourceInterval:[227,257]},null,[],["alt",{sourceInterval:[242,257]},["terminal",{sourceInterval:[242,245]},"_"],["app",{sourceInterval:[252,257]},"alnum",[]]]]}]);kr(U.BuiltInRules);Pr(Rr);function kr(t){let e={empty(){return this.iteration()},nonEmpty(n,r,s){return this.iteration([n].concat(s.children))},self(...n){return this}};G.BuiltInSemantics=G.createSemantics(t,null).addOperation("asIteration",{emptyListOf:e.empty,nonemptyListOf:e.nonEmpty,EmptyListOf:e.empty,NonemptyListOf:e.nonEmpty,_iter:e.self})}function Pr(t){G.prototypeGrammarSemantics=t.createSemantics().addOperation("parse",{AttributeSignature(e){return{name:e.parse(),formals:[]}},OperationSignature(e,n){return{name:e.parse(),formals:n.children.map(r=>r.parse())[0]||[]}},Formals(e,n,r){return n.asIteration().children.map(s=>s.parse())},name(e,n){return this.sourceString}}),G.prototypeGrammar=t}function $r(t){let e=0,n=[0],r=()=>n[n.length-1],s={},i=/( *).*(?:$|\r?\n|\r)/g,a;for(;(a=i.exec(t))!=null;){let[l,o]=a;if(l.length===0)break;let d=o.length,c=r(),u=e+d;if(d>c)n.push(d),s[u]=1;else if(d<c){let p=n.length;for(;r()!==d;)n.pop();s[u]=-1*(p-n.length)}e+=l.length}return n.length>1&&(s[e]=1-n.length),s}var vn="an indented block",In="a dedent",Xt=1114112,It=class extends be{constructor(e){super(e.input),this.state=e}_indentationAt(e){return this.state.userData[e]||0}atEnd(){return super.atEnd()&&this._indentationAt(this.pos)===0}next(){if(this._indentationAt(this.pos)!==0){this.examinedLength=Math.max(this.examinedLength,this.pos);return}return super.next()}nextCharCode(){return this._indentationAt(this.pos)!==0?(this.examinedLength=Math.max(this.examinedLength,this.pos),Xt):super.nextCharCode()}nextCodePoint(){return this._indentationAt(this.pos)!==0?(this.examinedLength=Math.max(this.examinedLength,this.pos),Xt):super.nextCodePoint()}},Ue=class extends I{constructor(e=!0){super(),this.isIndent=e}allowsSkippingPrecedingSpace(){return!0}eval(e){let{inputStream:n}=e,r=e.userData;e.doNotMemoize=!0;let s=n.pos,i=this.isIndent?1:-1;return(r[s]||0)*i>0?(e.userData=Object.create(r),e.userData[s]-=i,e.pushBinding(new ae(0),s),!0):(e.processFailure(s,this),!1)}getArity(){return 1}_assertAllApplicationsAreValid(e,n){}_isNullable(e,n){return!1}assertChoicesHaveUniformArity(e){}assertIteratedExprsAreNotNullable(e){}introduceParams(e){return this}substituteParams(e){return this}toString(){return this.isIndent?"indent":"dedent"}toDisplayString(){return this.toString()}toFailure(e){let n=this.isIndent?vn:In;return new z(this,n,"description")}},Mr=new b("indent"),Fr=new b("dedent"),Dr=new de(wt,"any",[Mr,Fr],[]),bn=new _e().newGrammar("IndentationSensitive").withSuperGrammar(wt).define("indent",[],new Ue(!0),vn,void 0,!0).define("dedent",[],new Ue(!1),In,void 0,!0).extend("any",[],Dr,"any character",void 0).build();Object.assign(bn,{_matchStateInitializer(t){t.userData=$r(t.input),t.inputStream=new It(t)},supportsIncrementalParsing:!1});var jr="17.3.0";U.initApplicationParser(He,At);var qr=t=>!!t.constructor&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t);function Br(t,e){let n=He.match(t,"Grammars");if(n.failed())throw Jn(n);return At(n,e)}function Gr(t,e){let n=xn(t,e),r=Object.keys(n);if(r.length===0)throw new Error("Missing grammar definition");if(r.length>1){let i=n[r[1]].source;throw new Error(_t(i.sourceString,i.startIdx)+"Found more than one grammar definition -- use ohm.grammars() instead.")}return n[r[0]]}function xn(t,e){let n=Object.create(e||{});if(typeof t!="string")if(qr(t))t=t.toString();else throw new TypeError("Expected string as first argument, got "+bt(t));return Br(t,n),n}te.ExperimentalIndentationSensitive=bn;te._buildGrammar=At;te.grammar=Gr;te.grammars=xn;te.makeRecipe=Ve;te.ohmGrammar=He;te.pexprs=Cr;te.version=jr});var En=X(W=>{"use strict";var Sn=W&&W.__createBinding||(Object.create?function(t,e,n,r){r===void 0&&(r=n);var s=Object.getOwnPropertyDescriptor(e,n);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,s)}:function(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]}),Ur=W&&W.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Ot=W&&W.__importStar||function(){var t=function(e){return t=Object.getOwnPropertyNames||function(n){var r=[];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[r.length]=s);return r},t(e)};return function(e){if(e&&e.__esModule)return e;var n={};if(e!=null)for(var r=t(e),s=0;s<r.length;s++)r[s]!=="default"&&Sn(n,e,r[s]);return Ur(n,e),n}}(),zr=W&&W.__exportStar||function(t,e){for(var n in t)n!=="default"&&!Object.prototype.hasOwnProperty.call(e,n)&&Sn(e,t,n)};Object.defineProperty(W,"__esModule",{value:!0});W.getAST=Kr;var Ts=Ot({}),Rs=Ot({}),Vr=Ot(_n());zr({},W);var Hr=`GRAM {
  Recipe = Frontmatter? Content?
  
  Content = 
    | (nl* Section)+      -- explicit
    | (nl* Block)+        -- implicit

  Frontmatter = "---" nl KeyValue* "---" (nl | end)
  KeyValue = key ":" sp* value nl
  key = (alnum | "_" | "-")+
  value = (~nl any)*

  Section = header Block*
  header = "##" sp+ title headerExtension? sp* nl+
  headerExtension = 
      | retroPlanning sp* intermediateDecl?  -- retro
      | intermediateDecl                     -- decl
  titleStop = nl | "->&" | "{T-"
  title = (~titleStop any)*
  
  retroPlanning = "{T-" (~"}" any)+ "}"
  
  Block = 
    | Comment nl*       -- comment
    | (~header step)    -- step
  
  step = startAction? line (nl line)* (nl+ | end)
  startAction = "[" (~"]" any)+ "]" sp*
  line = stepContent+
  stepContent = 
    | text
    | ws
    | intermediateDecl
    | applySyntactic<Element> 
    | fallback
    
  ws = space+

  fallback = ~nl any

  Element = 
    | Ingredient
    | Cookware
    | Timer
    | Temperature
    | Reference
    | CommentBlock
    | Comment

  intermediateDecl = "->&" name "{}"

  // Ingredients
  Ingredient = 
     | Alternative
     | simpleIngredient

  Alternative = simpleIngredient ("|" simpleIngredient)+
  
  // Rule: Quantity is mandatory (it's the delimiter)
  simpleIngredient = "@" modifier* name alias? ingredientQuantity preparation? composite?

  modifier = "?" | "-" | "*" | "&"
  alias = "[" space* name space* "]"
  ingredientQuantity = "{" space* (relativeQuantity | absoluteQuantity) space* "}"
  relativeQuantity = number space* "%" space* ("@" | "&") space* name
  absoluteQuantity = (fixed space*)? (range | number)? space* (unit space*)?
  textQuantity = "{" space* (~"}" any)+ space* "}"
  fixed = "="
  unit = unitName
  unitName = (alnum | sp | "\xB0" | "%")+
  preparation = "(" (~")" any)* ")"
  composite = "<" space* "@" space* name space* ingredientQuantity?

  // Cookware
  // Specs say use braces too.
  Cookware = 
    | CookwareAlternative
    | simpleCookware

  CookwareAlternative = simpleCookware ("|" simpleCookware)+
  simpleCookware = "#" modifier* name alias? cookwareQuantity preparation?

  // Restrict cookware quantity to only numbers/fixed, NO UNITS.
  // Allowed: {}, {2}, {=1}
  cookwareQuantity = "{" space* (fixed space*)? number? space* "}"

  // Timer
  Timer = "~" name? ingredientQuantity "&"?
  
  // Temperature
  Temperature = "!" name? (ingredientQuantity | textQuantity)


  // Comments
  Comment = "//" (~nl any)*
  CommentBlock = "/*" (~"*/" any)* "*/"

  // Primitives
  name = (~(syntaxChar | nl) any)+
  
  number = digit+ ("." digit+)? ("/" digit+)?
  range = number space* "-" space* number

  text = space* (~(elementStart | nl) any)+
  
  Reference = "&" name ingredientQuantity

  // SyntaxChar used for name content exclusion
  // Restricted to true delimiters that start a new component
  syntaxChar = "{" | "}" | "[" | "]" | "(" | ")" | "<" | "|" 
  
  // Name can contain '&' or '@' or other symbols, as long as it doesn't look like a start of a new element if specific context requires it?
  // Actually, standard grammar strategy: consume until a known delimiter.
  // The delimiters are:
  // - \`{\` (start of quantity)
  // - \`[\` (start of alias)
  // - \`(\` (start of preparation)
  // - \`<\` (start of composite)
  // - \`|\` (start of alternative)
  // - newline
  
  // We removed @, #, ~, !, &, ?, * from syntaxChar list effectively allowing them in names.

  
  // ElementStart used for text content exclusion
  // This remains strict to identify WHERE an element starts in free text.
  elementStart = "@" | "#" | "~" | "!" | "//" | "/*" | "->&" | "&"
  
  nl = "\\r"? "\\n"
  sp = " " | "\\t"
  space := sp
}
`,wn=Vr.grammar(Hr),K=t=>t.trim(),V=t=>t.children.length>0?t.children[0].toAST():null,Et=t=>{if(!t)return null;let[e,n]=t.split("/");if(n){let r=parseInt(e),s=parseInt(n);return{type:"fraction",value:r/s,numerator:r,denominator:s,text:t}}else return{type:"single",value:parseFloat(t),text:t}},Qr=t=>{t=t.trim();let e=n=>n&&(n.startsWith("'")||n.startsWith('"'))&&n[0]===n[n.length-1]?n.slice(1,-1):n;if(t.startsWith("[")&&t.endsWith("]")){let n=t.slice(1,-1).trim();return n?n.split(",").map(r=>e(r.trim())):[]}return e(t)},An=wn.createSemantics();An.addOperation("toAST",{Recipe(t,e){let n=V(t)||{},r=V(e)||[];return{type:"Recipe",meta:n,children:r}},Frontmatter(t,e,n,r,s){return n.children.map(i=>i.toAST()).reduce((i,a)=>({...i,...a}),{})},KeyValue(t,e,n,r,s){return{[t.sourceString]:Qr(r.sourceString)}},Content_explicit(t,e){return e.children.map(n=>n.toAST())},Content_implicit(t,e){return e.children.map(n=>n.toAST())},Section(t,e){let n=t.toAST();return{type:"Section",title:n.title,retroPlanning:n.retroPlanning,intermediateDecl:n.intermediateDecl,children:e.children.map(r=>r.toAST()),loc:{start:this.source.startIdx,end:this.source.endIdx}}},header(t,e,n,r,s,i){let a=null,l=null,o=V(r);return o&&(a=o.retroPlanning,l=o.intermediateDecl),{title:K(n.sourceString).replace(/^##\s*/,""),retroPlanning:a,intermediateDecl:l}},headerExtension_retro(t,e,n){let r=V(n);return{retroPlanning:t.toAST(),intermediateDecl:r}},headerExtension_decl(t){return{retroPlanning:null,intermediateDecl:t.toAST()}},retroPlanning(t,e,n){return K(e.sourceString)},Block_comment(t,e){return t.toAST()},Block_step(t){return t.toAST()},step(t,e,n,r,s){let i=V(t),a=[e.toAST()];r.children.forEach(o=>{a.push([{type:"Text",value:" "}]),a.push(o.toAST())});let l=a.flat().filter(o=>o!==null);return{type:"Step",action:i,children:l,loc:{start:this.source.startIdx,end:this.source.endIdx}}},startAction(t,e,n,r){return K(e.sourceString)},line(t){return t.children.map(e=>e.toAST())},stepContent(t){return t.toAST()},intermediateDecl(t,e,n){return{type:"IntermediateDecl",name:K(e.sourceString)}},text(t,e){return{type:"Text",value:t.sourceString+e.sourceString,loc:{start:this.source.startIdx,end:this.source.endIdx}}},fallback(t){return{type:"Text",value:t.sourceString,fallback:!0,loc:{start:this.source.startIdx,end:this.source.endIdx}}},nl(t,e){return null},ws(t){return{type:"Text",value:t.sourceString}},Ingredient(t){return t.toAST()},Alternative(t,e,n){return{type:"Alternative",options:[t.toAST(),...n.children.map(s=>s.toAST())],loc:{start:this.source.startIdx,end:this.source.endIdx}}},simpleIngredient(t,e,n,r,s,i,a){let l=e.children.map(o=>o.sourceString);return{type:"Ingredient",name:n.sourceString.trim(),modifiers:l,quantity:s.toAST(),alias:V(r),preparation:V(i),composite:V(a),loc:{start:this.source.startIdx,end:this.source.endIdx}}},composite(t,e,n,r,s,i,a){return{type:"Composite",parent:s.sourceString,quantity:V(a)}},alias(t,e,n,r,s){return K(n.sourceString)},preparation(t,e,n){return K(e.sourceString)},unit(t){return K(t.sourceString)},ingredientQuantity(t,e,n,r,s){return n.toAST()},relativeQuantity(t,e,n,r,s,i,a){return{type:"RelativeQuantity",percent:parseFloat(t.sourceString),target:K(a.sourceString),referenceType:s.sourceString==="&"?"variable":"ingredient",loc:{start:this.source.startIdx,end:this.source.endIdx}}},absoluteQuantity(t,e,n,r,s,i){return{type:"Quantity",value:V(n),unit:V(s),fixed:t.children.length>0,loc:{start:this.source.startIdx,end:this.source.endIdx}}},cookwareQuantity(t,e,n,r,s,i,a){return{type:"Quantity",value:V(s),unit:null,fixed:n.children.length>0,loc:{start:this.source.startIdx,end:this.source.endIdx}}},textQuantity(t,e,n,r,s){return{type:"TextQuantity",value:K(n.sourceString),loc:{start:this.source.startIdx,end:this.source.endIdx}}},number(t,e,n,r,s){return Et(this.sourceString)},range(t,e,n,r,s){let i=Et(t.sourceString),a=Et(s.sourceString);return i&&a?{type:"range",value:(i.value+a.value)/2,range:{min:i.value,max:a.value},text:this.sourceString}:null},CookwareAlternative(t,e,n){return{type:"Alternative",options:[t.toAST(),...n.children.map(r=>r.toAST())],loc:{start:this.source.startIdx,end:this.source.endIdx}}},simpleCookware(t,e,n,r,s,i){let a=e.children.map(l=>l.sourceString);return{type:"Cookware",name:K(n.sourceString),modifiers:a,alias:V(r),quantity:s.toAST(),preparation:V(i),loc:{start:this.source.startIdx,end:this.source.endIdx}}},Reference(t,e,n){return{type:"Reference",name:e.sourceString,quantity:n.toAST(),loc:{start:this.source.startIdx,end:this.source.endIdx}}},Timer(t,e,n,r){return{type:"Timer",name:e.children.length>0?K(e.children[0].sourceString):null,quantity:n.toAST(),isAsync:r.children.length>0,loc:{start:this.source.startIdx,end:this.source.endIdx}}},Temperature(t,e,n){return{type:"Temperature",name:e.children.length>0?K(e.children[0].sourceString):null,quantity:n.toAST(),loc:{start:this.source.startIdx,end:this.source.endIdx}}},Comment(t,e){return{type:"Comment",value:e.sourceString,kind:"line",loc:{start:this.source.startIdx,end:this.source.endIdx}}},CommentBlock(t,e,n){return{type:"Comment",value:e.sourceString,kind:"block",loc:{start:this.source.startIdx,end:this.source.endIdx}}},_terminal(){return null}});function Kr(t){let e=wn.match(t);if(e.failed())throw new Error(e.message);return An(e).toAST()}});var Nt=X(q=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0});q.quantityToMinutes=q.getMass=q.normalizeUnit=q.UNIT_CONVERSIONS=void 0;q.UNIT_CONVERSIONS={mass:{base:"g",map:{g:1,gram:1,grams:1,gramme:1,grammes:1,kg:1e3,kilogram:1e3,kilograms:1e3,mg:.001,milligram:.001,milligrams:.001,oz:28.3495,ounce:28.3495,ounces:28.3495,lb:453.592,lbs:453.592,pound:453.592,pounds:453.592}},volume:{base:"ml",map:{ml:1,milliliter:1,milliliters:1,l:1e3,liter:1e3,liters:1e3,litre:1e3,litres:1e3,cl:10,centiliter:10,dl:100,deciliter:100,tsp:4.9289,teaspoon:4.9289,teaspoons:4.9289,tbsp:14.7868,tablespoon:14.7868,tablespoons:14.7868,cup:236.588,cups:236.588,pint:473.176,quart:946.353,gallon:3785.41,"fl oz":29.5735,"fluid ounce":29.5735}}};var Wr=(t,e)=>{if(!t)return{quantity:0,unit:e||null};let n=(e||"").toLowerCase().trim(),r=t;if(typeof t=="object"&&t.value!==void 0&&(r=t.value),typeof r!="number")return{quantity:t,unit:n};for(let{base:s,map:i}of Object.values(q.UNIT_CONVERSIONS))if(i[n])return{quantity:r*i[n],unit:s};return{quantity:r,unit:n}};q.normalizeUnit=Wr;var Zr=(t,e)=>{let n=t;if(typeof t=="object"&&t!==null)if(t.type==="fraction")n=t.value;else if(t.type==="range")n=t.value;else if(t.type==="single")n=t.value;else return{mass:0,valid:!1};if(typeof n!="number")return{mass:0,valid:!1};let r=(e||"").toLowerCase().trim();return q.UNIT_CONVERSIONS.mass.map[r]?{mass:n*q.UNIT_CONVERSIONS.mass.map[r],valid:!0}:q.UNIT_CONVERSIONS.volume.map[r]?{mass:n*q.UNIT_CONVERSIONS.volume.map[r],valid:!0}:{mass:0,valid:!1}};q.getMass=Zr;var Jr=t=>{if(!t)return 0;let e=0,n="";if(typeof t=="object"){if(t.type==="Quantity"&&t.value){let s=t.value;s.type==="single"&&(e=s.value),s.type==="fraction"&&(e=s.value),s.type==="range"&&s.range&&(e=(s.range.min+s.range.max)/2),n=t.unit||""}else if(t.value!==void 0){let s=t.value;typeof s=="object"&&s!==null&&(s.type==="single"||s.type==="fraction"?s=s.value:s.type==="range"&&s.range&&(s=(s.range.min+s.range.max)/2)),e=s,n=t.unit||""}}else return 0;if(typeof e!="number")return 0;let r=n.toLowerCase().trim();return r==="h"||r==="hour"||r==="hours"||r==="heure"||r==="heures"?e*60:r==="m"||r==="min"||r==="minute"||r==="minutes"||r==="mins"?e:r==="s"||r==="sec"||r==="second"||r==="seconds"?e/60:e};q.quantityToMinutes=Jr});var Qe=X(ne=>{"use strict";Object.defineProperty(ne,"__esModule",{value:!0});ne.INGREDIENT_DB=void 0;ne.getIngredientData=Xr;var Yr=[{names:["flour","all-purpose flour","wheat flour"],data:{density:.53,macros:{calories:364,protein:10,carbs:76,fat:1,sugar:.3,fiber:2.7,salt:0}}},{names:["sugar","white sugar","granulated sugar"],data:{density:.85,macros:{calories:387,protein:0,carbs:100,fat:0,sugar:100,fiber:0,salt:0}}},{names:["brown sugar"],data:{density:.93,macros:{calories:380,protein:0,carbs:98,fat:0,sugar:97,fiber:0,salt:.04}}},{names:["powdered sugar","icing sugar"],data:{density:.56,macros:{calories:389,protein:0,carbs:100,fat:0}}},{names:["butter"],data:{density:.911,macros:{calories:717,protein:.85,carbs:.06,fat:81}}},{names:["oil","vegetable oil","olive oil"],data:{density:.92,macros:{calories:884,protein:0,carbs:0,fat:100}}},{names:["milk","whole milk"],data:{density:1.03,macros:{calories:61,protein:3.2,carbs:4.8,fat:3.3}}},{names:["water"],data:{density:1,macros:{calories:0,protein:0,carbs:0,fat:0}}},{names:["salt","sea salt"],data:{density:1.2,macros:{calories:0,protein:0,carbs:0,fat:0,salt:100}}},{names:["yeast","active dry yeast"],data:{density:.95,macros:{calories:325,protein:40,carbs:41,fat:7}}},{names:["baking powder"],data:{density:.9,macros:{calories:53,protein:0,carbs:28,fat:0}}},{names:["baking soda"],data:{density:1.2,macros:{calories:0,protein:0,carbs:0,fat:0}}},{names:["cocoa powder","cocoa"],data:{density:.44,macros:{calories:228,protein:20,carbs:58,fat:14}}},{names:["honey"],data:{density:1.42,macros:{calories:304,protein:.3,carbs:82,fat:0}}},{names:["maple syrup"],data:{density:1.37,macros:{calories:260,protein:0,carbs:67,fat:0}}},{names:["cream","heavy cream"],data:{density:1.01,macros:{calories:340,protein:2.8,carbs:2.7,fat:36}}},{names:["vanilla extract"],data:{density:.88,macros:{calories:288,protein:0,carbs:13,fat:0}}},{names:["cornstarch","corn flour"],data:{density:.65,macros:{calories:381,protein:.3,carbs:91,fat:.1}}},{names:["almond flour","ground almonds"],data:{density:.45,macros:{calories:579,protein:21,carbs:22,fat:50}}},{names:["chocolate chips","chocolate"],data:{density:.7,macros:{calories:546,protein:6,carbs:61,fat:31}}},{names:["cheese","cheddar"],data:{density:.6,macros:{calories:403,protein:25,carbs:1.3,fat:33}}},{names:["egg","eggs"],data:{density:1.03,unit_weight:55,yield:.88,macros:{calories:143,protein:12.6,carbs:.7,fat:9.5}}},{names:["egg yolk","egg yolks","yolk","yolks"],data:{density:1.03,unit_weight:18,macros:{calories:322,protein:16,carbs:3.6,fat:27}}},{names:["egg white","egg whites","white","whites"],data:{density:1.03,unit_weight:33,macros:{calories:52,protein:11,carbs:.7,fat:.2}}},{names:["lemon","lemons"],data:{density:1,unit_weight:120,yield:.5,macros:{calories:29,protein:1.1,carbs:9,fat:.3}}},{names:["lemon juice","juice"],data:{density:1.04,unit_weight:45,macros:{calories:22,protein:.35,carbs:6.9,fat:.2}}},{names:["lemon zest","zest"],data:{density:.5,unit_weight:3,macros:{calories:47,protein:1.5,carbs:16,fat:.3}}},{names:["lime","limes"],data:{density:1,unit_weight:60,yield:.55,macros:{calories:30,protein:.7,carbs:11,fat:.2}}},{names:["onion","onions","yellow onion"],data:{density:.7,unit_weight:150,yield:.9,macros:{calories:40,protein:1.1,carbs:9.3,fat:.1}}},{names:["red onion","red onions"],data:{density:.7,unit_weight:150,yield:.9,macros:{calories:40,protein:1.1,carbs:9.3,fat:.1}}},{names:["garlic","garlic clove","garlic cloves"],data:{density:.6,unit_weight:5,yield:.85,macros:{calories:149,protein:6.4,carbs:33,fat:.5}}},{names:["carrot","carrots"],data:{density:.7,unit_weight:100,yield:.8,macros:{calories:41,protein:.9,carbs:9.6,fat:.2,sugar:4.7,fiber:2.8,salt:.1}}},{names:["potato","potatoes","russet potato"],data:{density:.77,unit_weight:200,yield:.8,macros:{calories:77,protein:2,carbs:17,fat:.1,sugar:.8,fiber:2.2,salt:0}}},{names:["apple","apples"],data:{density:.6,unit_weight:180,yield:.75,macros:{calories:52,protein:.3,carbs:14,fat:.2,sugar:10,fiber:2.4,salt:0}}},{names:["banana","bananas"],data:{density:.9,unit_weight:120,yield:.65,macros:{calories:89,protein:1.1,carbs:23,fat:.3,sugar:12,fiber:2.6,salt:0}}},{names:["tomato","tomatoes"],data:{density:.95,unit_weight:120,yield:.91,macros:{calories:18,protein:.9,carbs:3.9,fat:.2,sugar:2.6,fiber:1.2,salt:.01}}},{names:["canned tomatoes","canned tomato"],data:{density:1.1,macros:{calories:32,protein:1.6,carbs:7.3,fat:.3}}},{names:["bell pepper","red bell pepper","green bell pepper"],data:{density:.5,unit_weight:150,yield:.82,macros:{calories:26,protein:1,carbs:6,fat:.3}}},{names:["chili","chili pepper","espelette pepper"],data:{density:.5,unit_weight:15,yield:.85,macros:{calories:40,protein:1.9,carbs:9,fat:.4}}},{names:["ginger"],data:{density:.9,unit_weight:30,yield:.75,macros:{calories:80,protein:1.8,carbs:18,fat:.8}}},{names:["spinach"],data:{density:.1,unit_weight:300,yield:.9,macros:{calories:23,protein:2.9,carbs:3.6,fat:.4}}},{names:["chicken","chicken breast"],data:{density:1.05,unit_weight:200,macros:{calories:165,protein:31,carbs:0,fat:3.6}}},{names:["chicken thigh","chicken thighs"],data:{density:1.05,unit_weight:120,macros:{calories:209,protein:26,carbs:0,fat:10.9}}},{names:["beef","ground beef","steak"],data:{density:1.05,macros:{calories:250,protein:26,carbs:0,fat:17}}},{names:["pork","pork chop"],data:{density:1.05,unit_weight:150,macros:{calories:242,protein:27,carbs:0,fat:14}}},{names:["bacon"],data:{density:.5,macros:{calories:541,protein:37,carbs:1.4,fat:42}}},{names:["tofu"],data:{density:.95,macros:{calories:76,protein:8.1,carbs:1.9,fat:4.8}}},{names:["pepper","black pepper","ground pepper"],data:{density:.5,macros:{calories:251,protein:10,carbs:64,fat:3.3}}},{names:["cinnamon"],data:{density:.55,macros:{calories:247,protein:4,carbs:81,fat:1.2}}},{names:["paprika"],data:{density:.45,macros:{calories:282,protein:14,carbs:54,fat:13}}},{names:["cumin"],data:{density:.45,macros:{calories:375,protein:18,carbs:44,fat:22}}},{names:["turmeric"],data:{density:.6,macros:{calories:354,protein:8,carbs:65,fat:10}}},{names:["stock","chicken stock","beef stock","vegetable stock","broth"],data:{density:1.01,macros:{calories:15,protein:2,carbs:1,fat:.5}}},{names:["mayonnaise"],data:{density:.92,macros:{calories:680,protein:1,carbs:1,fat:75}}},{names:["mustard"],data:{density:1.05,macros:{calories:66,protein:4,carbs:8,fat:4}}},{names:["ketchup"],data:{density:1.15,macros:{calories:111,protein:1,carbs:26,fat:0}}},{names:["rice"],data:{density:.85,macros:{calories:360,protein:7,carbs:80,fat:.7}}},{names:["basmati rice"],data:{density:.85,macros:{calories:350,protein:8,carbs:77,fat:.5}}},{names:["oats","rolled oats"],data:{density:.4,macros:{calories:389,protein:17,carbs:66,fat:7}}},{names:["pasta","spaghetti"],data:{density:1.3,macros:{calories:371,protein:13,carbs:75,fat:1.5}}},{names:["wine","red wine","white wine"],data:{density:.99}},{names:["vinegar"],data:{density:1.01}},{names:["soy sauce"],data:{density:1.13}},{names:["maple syrup"],data:{density:1.32}}];ne.INGREDIENT_DB={};Yr.forEach(t=>{t.names.forEach(e=>{ne.INGREDIENT_DB[e]=t.data})});function Xr(t){let e=t.toLowerCase().trim();return ne.INGREDIENT_DB[e]?ne.INGREDIENT_DB[e]:e.endsWith("s")&&ne.INGREDIENT_DB[e.slice(0,-1)]?ne.INGREDIENT_DB[e.slice(0,-1)]:null}});var Re=X(Ct=>{"use strict";Object.defineProperty(Ct,"__esModule",{value:!0});Ct.normalizeMass=es;var On=Nt(),Nn=Qe(),Ke=We();function es(t,e,n,r){let s=e.toLowerCase().trim(),i=On.UNIT_CONVERSIONS.mass.map;if(i[s]!==void 0)return{mass:t*i[s],method:"physical",isEstimate:!1};let a=On.UNIT_CONVERSIONS.volume.map;if(a[s]!==void 0){let l=t*a[s],o=1,d="default";if(n)if(r&&r[(0,Ke.slugify)(n)])o=r[(0,Ke.slugify)(n)],d="explicit";else{let c=(0,Nn.getIngredientData)(n);c&&(o=c.density,d="density")}return{mass:l*o,method:d,isEstimate:d!=="explicit"}}if(n){if(r&&r[(0,Ke.slugify)(n)]){let o=r[(0,Ke.slugify)(n)];return{mass:t*o,method:"explicit",isEstimate:!1}}let l=(0,Nn.getIngredientData)(n);if(l&&l.unit_weight)return{mass:t*l.unit_weight,method:"unit_weight",isEstimate:!0}}return null}});var We=X(H=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0});H.cleanObject=H.createCleanUsage=H.minifyQuantity=H.slugify=void 0;var ts=t=>t.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")||"unknown";H.slugify=ts;var ns=t=>{if(t){if(typeof t=="number")return t;if(t.type==="single"&&t.value!==void 0)return t.value;if(t.type==="range"||t.type==="fraction")return t;if(t.type==="Quantity")return t.value&&t.value.type==="single"?t.value.value:t.value;if(t.type!=="RelativeQuantity")return t}};H.minifyQuantity=ns;var rs=Re(),ss=(t,e,n)=>{let r={id:e},s=t.quantity,i;s&&(s.type==="TextQuantity"?i=s.value:i=(0,H.minifyQuantity)(s.value||s)),i!==void 0&&(r.qty=i),s&&s.unit&&(r.unit=s.unit);let a=null;if(typeof r.qty=="number"?a=r.qty:r.qty&&typeof r.qty=="object"&&typeof r.qty.value=="number"&&(a=r.qty.value),a!==null){let l=r.unit||"unit",o=(0,rs.normalizeMass)(a,l,t.name,n);o&&(r.normalizedMass=o.mass,r.conversionMethod=o.method,r.isEstimate=o.isEstimate)}if(t.modifiers&&t.modifiers.length>0){let l={"?":"optional","-":"hidden","&":"reference","*":"bakers_percentage"};r.modifiers=t.modifiers.map(o=>l[o]||o)}if(t.type==="Cookware"?s&&s.fixed===!1&&(r.fixed=!1):s&&s.fixed===!0&&(r.fixed=!0),s&&s.type==="TextQuantity"&&(r.qty=s.value,r.fixed=!0),t.alias&&(r.alias=t.alias),t.preparation&&(r.preparation=t.preparation),t.composite){let l={};if(t.composite.parent&&(l.parent=t.composite.parent),t.composite.quantity){let o=t.composite.quantity,d=(0,H.minifyQuantity)(o);d!==void 0&&(l.quantity=d),o.unit&&(l.unit=o.unit)}r.composite=l}return r};H.createCleanUsage=ss;var is=t=>{if(t!=null){if(Array.isArray(t))return t.map(H.cleanObject).filter(n=>n!=null);if(typeof t=="object"){let e={};for(let n in t){let r=t[n],s=(0,H.cleanObject)(r);if(s!=null){if(Array.isArray(s)&&s.length===0)continue;e[n]=s}}return e}return t}};H.cleanObject=is});var Cn=X(Lt=>{"use strict";Object.defineProperty(Lt,"__esModule",{value:!0});Lt.detectCycles=as;function as(t){let e=new Map;t.forEach(a=>{a.ingredients.forEach(l=>{l.dependencies&&(e.has(l.id)||e.set(l.id,new Set),l.dependencies.forEach(o=>e.get(l.id)?.add(o)))})});let n=new Set,r=new Set,s=new Set;function i(a){n.add(a),r.add(a);let l=e.get(a);if(l)for(let o of l)n.has(o)?r.has(o)&&(s.add(a),s.add(o)):i(o);r.delete(a)}for(let[a]of e)n.has(a)||i(a);return s}});var Ln=X(kt=>{"use strict";Object.defineProperty(kt,"__esModule",{value:!0});kt.generateShoppingList=us;var Tt=We(),Rt=Re(),os=Qe(),ls=Cn();function cs(t){return t?typeof t=="number"?t:t.type==="single"?t.value:t.type==="range"?t.text||`${t.value}`:t.type==="fraction"?t.text||`${t.value}`:JSON.stringify(t):""}function us(t,e,n){let r=new Map,s=new Map,i=[],a=(0,ls.detectCycles)(t);t.forEach(d=>{d.ingredients.forEach(c=>{if(c.type==="alternative"){i.push(c);return}if(a.has(c.id)&&(c.isCircular=!0),c.composite){let g=(0,Tt.slugify)(c.composite.parent);s.has(g)||s.set(g,{type:"composite",id:g,qty:0,usage:[],_subUsageMap:new Map,_usageAccumulator:new Map});let v=s.get(g),N=0;if(c.composite&&c.composite.quantity){let E=(0,Tt.minifyQuantity)(c.composite.quantity);typeof E=="number"&&(N=E)}let x=c.id,ye=v._subUsageMap.get(x)||0;v._subUsageMap.set(x,ye+N);let nt=c.unit||"",ue=`${x}::${nt}`;v._usageAccumulator.has(ue)||v._usageAccumulator.set(ue,{id:x,unit:c.unit,qty:0,alias:c.alias});let ve=v._usageAccumulator.get(ue),Ie=0;if(typeof c.qty=="number")Ie=c.qty;else if(c.qty&&typeof c.qty=="object"){let E=(0,Tt.minifyQuantity)(c.qty);typeof E=="number"&&(Ie=E)}typeof ve.qty=="number"&&(ve.qty+=Ie);return}let u=c.id,p=u;r.has(p)||r.set(p,{id:u,name:e.ingredients.get(u)?.name||c.name,sureMass:0,otherUnits:{},variableParts:[],_hasSure:!1,normalizedMass:0,isEstimate:!1,conversionMethod:"physical"});let h=r.get(p),f=null,m=c.unit||"",y=!1;if(c.formula)c.formula.isGhost?y=!0:typeof c.qty=="number"&&(f=c.qty);else if(typeof c.qty=="number")f=c.qty;else if(c.qty&&typeof c.qty=="object"){let g=c.qty;(g.type==="fraction"||g.type==="range"||g.type==="single")&&(f=g.value)}if(y){let g=c.formula?c.formula.raw:c.qty&&c.qty.value||"";c.formula&&(g=c.formula.raw);let v=`${g} \u2753`;h.variableParts.push(`(${v})`)}else if(f!==null){let g=(0,Rt.normalizeMass)(f,m,h.name,n);if(g&&(h.normalizedMass=(h.normalizedMass||0)+g.mass,g.isEstimate&&(h.isEstimate=!0)),g&&g.method==="physical")h.sureMass+=g.mass,h._hasSure=!0;else{let v=m;h.otherUnits[v]||(h.otherUnits[v]=0),h.otherUnits[v]+=f}}else if(c.qty){let g=cs(c.qty),v=m?` ${m}`:"";h.variableParts.push(`${g}${v}`)}!y&&c.isCircular&&h.variableParts.push("\u26A0\uFE0F Ref. Circulaire")})});let l=[...r.values()].map(d=>{let c={id:d.id,name:d.name,normalizedMass:d.normalizedMass,isEstimate:d.isEstimate,conversionMethod:d.isEstimate?"estimate":"physical"};if(d.sureMass>0)c.qty=parseFloat(d.sureMass.toFixed(2)),c.unit="g";else{let m=Object.keys(d.otherUnits);m.length>0&&(c.qty=parseFloat(d.otherUnits[m[0]].toFixed(2)),c.unit=m[0]||null)}if(c.normalizedMass&&c.normalizedMass>0){let m=(0,os.getIngredientData)(d.id);if(m&&m.yield&&m.yield<1){let y=c.normalizedMass/m.yield;c.purchasingMass=parseFloat(y.toFixed(2))}}let u=d.sureMass>0,p=Object.keys(d.otherUnits).length>0,h=[];if(u)for(let[m,y]of Object.entries(d.otherUnits)){let g=m?` ${m}`:"";h.push(`${parseFloat(y.toFixed(2))}${g}`)}else if(p){let m=Object.keys(d.otherUnits);for(let y=1;y<m.length;y++){let g=m[y],v=g?` ${g}`:"";h.push(`${parseFloat(d.otherUnits[g].toFixed(2))}${v}`)}}let f=[...h,...d.variableParts||[]];return f.length>0&&(c.variable_entries=f),c}),o=[...s.values()].map(d=>{let c=0;for(let f of d._subUsageMap.values())f>c&&(c=f);d.qty=c;let u=e.ingredients.get(d.id)?.name||d.id,p=(0,Rt.normalizeMass)(d.qty,"unit",u,n),h={type:"composite",id:d.id,name:u,qty:d.qty,usage:[]};return p&&(h.normalizedMass=p.mass,h.isEstimate=p.isEstimate,h.conversionMethod=p.method),h.usage=[...d._usageAccumulator.values()].map(f=>{let m={...f};if(f.qty&&typeof f.qty=="number"){let y=f.id||"",g=e.ingredients.get(y)?.name||y,v=(0,Rt.normalizeMass)(f.qty,f.unit||"",g,n);v&&(m.normalizedMass=v.mass,m.isEstimate=v.isEstimate,m.conversionMethod=v.method)}return m}),h});return[...l,...o,...i]}});var Tn=X(Pt=>{"use strict";Object.defineProperty(Pt,"__esModule",{value:!0});Pt.calculateNutrition=ds;var ps=Qe(),hs=Re();function ds(t,e=1){let n={calories:0,protein:0,carbs:0,fat:0,sugar:0,fiber:0,salt:0},r=0,s=0,i=[];t.forEach(o=>{o.type==="composite"&&o.usage?i.push(o):o.type==="alternative"?o.options&&o.options.length>0&&i.push(o.options[0]):i.push(o)}),i.forEach(o=>{let d=o.id;if(!d)return;r++;let c=0,u=!1;if(o.qty&&(typeof o.qty=="number"||o.qty.value)){let p=typeof o.qty=="number"?o.qty:o.qty.value,h=o.unit||"unit",f=(0,hs.normalizeMass)(p,h,o.name);f&&(c=f.mass,u=f.isEstimate)}if(c>0){let p=(0,ps.getIngredientData)(d);if(p&&p.macros){s++;let h=c/100;n.calories+=p.macros.calories*h,n.protein+=p.macros.protein*h,n.carbs+=p.macros.carbs*h,n.fat+=p.macros.fat*h,p.macros.sugar!==void 0&&(n.sugar=(n.sugar||0)+p.macros.sugar*h),p.macros.fiber!==void 0&&(n.fiber=(n.fiber||0)+p.macros.fiber*h),p.macros.salt!==void 0&&(n.salt=(n.salt||0)+p.macros.salt*h)}}});let a=r>0?s/r:0;n.calories=Math.round(n.calories),n.protein=Math.round(n.protein*10)/10,n.carbs=Math.round(n.carbs*10)/10,n.fat=Math.round(n.fat*10)/10,n.sugar!==void 0&&(n.sugar=Math.round(n.sugar*10)/10),n.fiber!==void 0&&(n.fiber=Math.round(n.fiber*10)/10),n.salt!==void 0&&(n.salt=Math.round(n.salt*100)/100);let l={total:n,isEstimate:!0,coverage:a};return e>1&&(l.perPortion={calories:Math.round(n.calories/e),protein:Math.round(n.protein/e*10)/10,carbs:Math.round(n.carbs/e*10)/10,fat:Math.round(n.fat/e*10)/10,sugar:n.sugar!==void 0?Math.round(n.sugar/e*10)/10:0,fiber:n.fiber!==void 0?Math.round(n.fiber/e*10)/10:0,salt:n.salt!==void 0?Math.round(n.salt/e*100)/100:0}),l}});var kn=X(Je=>{"use strict";Object.defineProperty(Je,"__esModule",{value:!0});Je.processBlockItem=$t;Je.compile=vs;var fs=Nt(),B=We(),ms=Ln(),gs=Tn(),Ze=Re();function $t(t,e,n,r,s){if(!t)return null;if(t.type==="Ingredient"){let i=(0,B.slugify)(t.name);if(!n.ingredients.has(i)){let o=null;t.quantity&&t.quantity.unit&&(o=t.quantity.unit),n.ingredients.set(i,{id:i,name:t.name,default_unit:o})}let a=n.ingredients.get(i);if(a&&t.quantity&&t.quantity.unit&&!a.default_unit&&(a.default_unit=t.quantity.unit),t.composite){a&&(a.is_composite=!0);let o=(0,B.slugify)(t.composite.parent);if(a&&(a.parent=o),!n.ingredients.has(o))n.ingredients.set(o,{id:o,name:t.composite.parent,is_composite:!0});else{let d=n.ingredients.get(o);d&&(d.is_composite=!0)}}if(t.quantity&&t.quantity.type==="RelativeQuantity"){let o=t.quantity,d=o.target,c=(0,B.slugify)(d),u=o.percent,p=0,h=null,f=!1,m=o.referenceType==="variable"?"&":"@",y=`${u}% de ${m}${d}`;if(o.referenceType==="variable")if(e.variableWeights.has(c)){let N=e.variableWeights.get(c);N&&(p=N.mass,h="g")}else f=!0,e.warnings.push({code:"VARIABLE_NOT_FOUND",message:`Variable '&${d}' not found or has undefined mass.`,item:t.name});else if(!r.some(x=>x.id===c))f=!0,e.warnings.push({code:"RELATIVE_QUANTITY_UNRESOLVED",message:`Could not resolve relative quantity for '@${d}'. Source not found.`,item:t.name});else{for(let x of r)if(x.id===c){if(x.normalizedMass)p+=x.normalizedMass,h||(h="g");else if(x.qty&&typeof x.qty=="number"&&x.unit){let ye=(0,Ze.normalizeMass)(x.qty,x.unit,x.name,e.densityOverrides);ye&&(p+=ye.mass,h||(h="g"))}}h||(f=!0,e.warnings.push({code:"RELATIVE_NO_MASS",message:`Source '@${d}' has no mass (unitless or incompatible). Calculation impossible.`,item:t.name}))}let g=p*(u/100),v=(0,B.createCleanUsage)(t,i,e.densityOverrides);if(v.qty=parseFloat(g.toFixed(2)),v.unit=h||"g",v.unit){let N=(0,Ze.normalizeMass)(v.qty,v.unit,v.name||t.name,e.densityOverrides);N&&(v.normalizedMass=N.mass,v.conversionMethod=N.method,v.isEstimate=N.isEstimate)}return c===i&&(v.isCircular=!0,e.warnings.push({code:"CIRCULAR_REFERENCE",message:`Circular reference detected: ${t.name} depends on itself.`,item:t.name})),v.dependencies=[c],v.formula={raw:y,target:d,percent:u,isGhost:f},r.push(v),v}let l=(0,B.createCleanUsage)(t,i,e.densityOverrides);return t.modifiers&&t.modifiers.includes("&")?(e.seenNames.has(t.name)||e.warnings.push({code:"UNDEFINED_REFERENCE",message:`Reference to undefined ingredient '@&${t.name}'.`,item:t.name}),e.definedIntermediates.has(t.name)&&e.usedIntermediates.add(t.name)):e.seenNames.add(t.name),(!t.modifiers||!t.modifiers.includes("&")||t.quantity)&&r.push(l),l}if(t.type==="Cookware"){let i=(0,B.slugify)(t.name);n.cookware.has(i)||n.cookware.set(i,{id:i,name:t.name});let a=(0,B.createCleanUsage)(t,i,e.densityOverrides);return s.push(a),a}if(t.type==="Alternative"){let i=[],a=[...r],l=[...s];t.options.forEach(d=>{let c=[...a],u=[...l],p=$t(d,e,n,c,u);if(i.push(p),p&&typeof p!="string"){let h=p;(h.type==="ingredient"||h.type==="drink"||h.id&&!h.type)&&a.push(h),h.type==="cookware"&&l.push(h)}});let o={id:"alternative",type:"alternative",options:i};return t.options.length>0&&(t.options[0].type==="Ingredient"?r.push(o):t.options[0].type==="Cookware"&&s.push(o)),o}if(t.type==="Reference"){let i=(0,B.slugify)(t.name);n.ingredients.has(i)||e.warnings.push({code:"UNDEFINED_REFERENCE",message:`Reference to undefined ingredient '&${t.name}'.`,item:t.name}),e.definedIntermediates.has(t.name)&&e.usedIntermediates.add(t.name);let a={type:"reference",id:i,name:t.name};if(t.quantity){let l=(0,B.minifyQuantity)(t.quantity);if(l!==void 0&&(a.qty=l),t.quantity.unit&&(a.unit=t.quantity.unit),t.quantity.type==="TextQuantity"&&(a.qty=t.quantity.value),a.qty&&typeof a.qty=="number"){let o=(0,Ze.normalizeMass)(a.qty,a.unit||"",t.name,e.densityOverrides);o&&(a.normalizedMass=o.mass,a.conversionMethod=o.method,a.isEstimate=o.isEstimate)}}else if(e.variableWeights.has(i)){let l=e.variableWeights.get(i);l&&(a.normalizedMass=l.mass,a.isEstimate=l.isPartial,a.conversionMethod="physical")}return a}if(t.type==="IntermediateDecl"){let i=(0,B.slugify)(t.name);if(e.intermediateDecl=i,!n.ingredients.has(i))n.ingredients.set(i,{id:i,name:t.name,is_intermediate:!0});else{let a=n.ingredients.get(i);a&&(a.is_intermediate=!0)}return null}if(t.type==="Text")return t.value;if(t.type==="Timer"||t.type==="Temperature"){let i={type:t.type.toLowerCase()};if(t.name&&(i.name=t.name),t.type==="Timer"&&t.isAsync&&(i.isAsync=!0),t.quantity){let a=t.quantity;a.value&&(i.quantity=a.value);let l=a.unit;t.type==="Timer"&&(l==="m"||l==="minutes")&&(l="min"),l&&(i.unit=l),a.type==="TextQuantity"?(e.warnings.push({code:"INVALID_UNIT",message:`Invalid text content in ${t.type}.`,item:a.value}),i.quantity={type:"text",value:a.value}):l||e.warnings.push({code:"MISSING_UNIT",message:`${t.type} must have an explicit unit.`,item:t.name||t.type})}return i}return t.type==="Comment"?{type:"comment",value:t.value,kind:t.kind}:t}function Rn(t){let e=0,n=[],r=!1;t.forEach(i=>{let a=i;if((i.type==="alternative"||i.type==="group")&&i.options&&i.options.length>0&&(a=i.options[0]),a.normalizedMass)e+=a.normalizedMass,a.isEstimate&&(r=!0);else{let l=a.type||"ingredient";(["ingredient","reference","alternative","group"].includes(l)||!a.type)&&n.push(a.name||a.id)}});let s="precise";return n.length>0?s="incomplete":r&&(s="estimated"),{totalMass:parseFloat(e.toFixed(2)),massStatus:s,missingMassIngredients:n}}function ys(t,e,n){let r={warnings:e.warnings,intermediateDecl:null,seenNames:new Set,definedIntermediates:new Set,usedIntermediates:new Set,variableWeights:new Map,globalScopes:new Map,densityOverrides:n||{}},s=[],i=t;i.length>0&&i[0].type!=="Section"&&(i=[{type:"Section",title:null,children:t}]);let a=0,l=0,o=[];i.forEach(u=>{if(u.type!=="Section")return;if(u.intermediateDecl){let y=u.intermediateDecl.name;r.globalScopes.has(y)?e.warnings.push({code:"SCOPE_CONFLICT",message:`La variable globale '&${y}' est red\xE9finie.`,section:u.title}):r.globalScopes.set(y,u.title);let g=(0,B.slugify)(y);e.ingredients.has(g)||e.ingredients.set(g,{id:g,name:y,is_intermediate:!0}),r.definedIntermediates.add(y)}let p=[],h=[],f=[];u.children.forEach(y=>{if(y.type==="Step"){let g=0,v=[],N=[],x="";r.intermediateDecl=null,y.children.forEach(E=>{let le=$t(E,r,e,p,h);if(le)if(N.push(le),typeof le=="string")x+=le;else{let _=le;if(_.type==="timer"&&_.quantity){let rt=_.quantity.value||_.quantity,Bn=_.unit||"",Gn=_.name?`~${_.name}`:"~";x+=`${Gn}{${rt}${Bn}}`,_.isAsync&&(x+="&");let st=(0,fs.quantityToMinutes)({value:_.quantity,unit:_.unit});_.isAsync?(v.push({name:_.name||"Timer",duration:st,startOffset:g}),o.push({end:a+g+st})):g+=st}else if(_.type==="ingredient")x+=`@${_.name}`;else if(_.type==="cookware")x+=`#${_.name}`;else if(_.type==="temperature"){let rt=_.quantity&&_.quantity.value?_.quantity.value:_.quantity||"";x+=`!${_.name||""}{${rt}${_.unit||""}}`}else _.type==="reference"&&(x+=`&${_.name}`)}}),g===0&&v.length===0&&(g=2);let ye=a,nt=a+g,ue={type:"step",value:x.trim(),content:N,timings:{start:ye,end:nt,activeDuration:g},backgroundTasks:v};y.action&&(ue.action=y.action),a+=g,l+=g;let ve=0,Ie=!0;if(N.forEach(E=>{if(typeof E!="string"){if(E.normalizedMass)ve+=E.normalizedMass;else if(E.qty&&typeof E.qty=="number"&&E.unit){let le=(0,Ze.normalizeMass)(E.qty,E.unit,E.name,r.densityOverrides);le&&(ve+=le.mass)}E.type==="ingredient"&&!E.normalizedMass&&(Ie=!1)}}),r.intermediateDecl){let E=r.intermediateDecl;r.variableWeights.set(E,{mass:ve,isPartial:!Ie}),ue.intermediate_preparation=r.intermediateDecl}f.push(ue)}else y.type==="Comment"&&f.push({type:"comment",value:y.value,kind:y.kind})});let m={title:u.title,ingredients:p,cookware:h,steps:f};if(u.intermediateDecl){m.intermediate_preparation=u.intermediateDecl.name;let y=0,g=!1;m.ingredients.forEach(N=>{N.normalizedMass?y+=N.normalizedMass:g=!0});let v=(0,B.slugify)(u.intermediateDecl.name);r.variableWeights.set(v,{mass:y,isPartial:g})}u.retroPlanning&&(m.retro_planning=u.retroPlanning),s.push(m)});let d=0;o.forEach(u=>{u.end>d&&(d=u.end)});let c=Math.max(a,d);return{sections:s,metrics:{totalTime:c,activeTime:l}}}function vs(t){if(t.type!=="Recipe")throw new Error("Compiler expects Recipe AST");let e={ingredients:new Map,cookware:new Map,warnings:[]},n={};if(t.meta&&t.meta.densities){let c=t.meta.densities;(Array.isArray(c)?c:[c]).forEach(p=>{let h=p.split(":");if(h.length===2){let f=(0,B.slugify)(h[0]),m=parseFloat(h[1].trim());isNaN(m)||(n[f]=m)}})}let r=ys(t.children,e,n),s=r.sections;s.forEach(c=>{c.metrics=Rn(c.ingredients)});let i=[];s.forEach(c=>{c.ingredients.forEach(u=>{u.type!=="reference"&&i.push(u)})});let a=Rn(i),l=(0,ms.generateShoppingList)(s,e,n),o=[];s.forEach(c=>{c.cookware.forEach(u=>{(!u.modifiers||!u.modifiers.includes("reference"))&&o.push(u)})});let d={title:t.meta.title||null,slug:t.meta.title?(0,B.slugify)(t.meta.title):null,meta:t.meta,registry:{ingredients:Object.fromEntries(e.ingredients),cookware:Object.fromEntries(e.cookware)},shopping_list:l,cookware:o,sections:s,warnings:e.warnings,metrics:{...r.metrics,...a,preparationTime:(()=>{let c=0;c+=e.ingredients.size*1,c+=e.cookware.size*1;let u=p=>{let h=0;if(!p)return 0;if(p.type==="ingredient"&&p.preparation&&(h+=2),p.options&&Array.isArray(p.options)){let f=0;p.options.forEach(m=>{let y=u(m);y>f&&(f=y)}),h+=f}else!p.type&&p.id&&p.preparation&&(h+=2);return h};return s.forEach(p=>{p.steps.forEach(h=>{h.content&&h.content.forEach(f=>{c+=u(f)})})}),c})(),nutrition:(()=>{let c=1;if(t.meta&&t.meta.portions){let u=Array.isArray(t.meta.portions)?t.meta.portions[0]:t.meta.portions;if(u){let p=u.toString().match(/(\d+)/);p&&(c=parseInt(p[1],10))}}return c<1&&(c=1),(0,gs.calculateNutrition)(l,c)})()}};return(0,B.cleanObject)(d)}});var Mn=Bt(En()),Fn=Bt(kn()),se=document.getElementById("input"),Z=document.getElementById("output"),Ye=document.getElementById("status"),Dn=document.getElementById("theme-toggle"),$e=document.getElementById("warnings"),Pn=document.getElementById("view-mode"),$n=document.getElementById("mass-toggle-container"),Mt=document.getElementById("show-mass"),Is=localStorage.getItem("showMass");Is==="false"&&(Mt.checked=!1,document.body.classList.add("hide-mass-badges"));Pn.addEventListener("change",()=>{J=Pn.value,jn(),tt()});Mt.addEventListener("change",()=>{let t=Mt.checked;localStorage.setItem("showMass",t),t?document.body.classList.remove("hide-mass-badges"):document.body.classList.add("hide-mass-badges")});function jn(){J==="preview"?$n.style.display="flex":$n.style.display="none"}jn();Dn.addEventListener("click",()=>{document.body.classList.toggle("light");let t=document.body.classList.contains("light");localStorage.setItem("theme",t?"light":"dark"),Ft(t)});function Ft(t){Dn.innerHTML=t?'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#000000" viewBox="0 0 256 256"><path d="M236.37,139.4a12,12,0,0,0-12-3A84.07,84.07,0,0,1,119.6,31.59a12,12,0,0,0-15-15A108.86,108.86,0,0,0,49.69,55.07,108,108,0,0,0,136,228a107.09,107.09,0,0,0,64.93-21.69,108.86,108.86,0,0,0,38.44-54.94A12,12,0,0,0,236.37,139.4Zm-49.88,47.74A84,84,0,0,1,68.86,69.51,84.93,84.93,0,0,1,92.27,48.29Q92,52.13,92,56A108.12,108.12,0,0,0,200,164q3.87,0,7.71-.27A84.79,84.79,0,0,1,186.49,187.14Z"></path></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#ffffff" viewBox="0 0 256 256"><path d="M116,36V20a12,12,0,0,1,24,0V36a12,12,0,0,1-24,0Zm80,92a68,68,0,1,1-68-68A68.07,68.07,0,0,1,196,128Zm-24,0a44,44,0,1,0-44,44A44.05,44.05,0,0,0,172,128ZM51.51,68.49a12,12,0,1,0,17-17l-12-12a12,12,0,0,0-17,17Zm0,119-12,12a12,12,0,0,0,17,17l12-12a12,12,0,1,0-17-17ZM196,72a12,12,0,0,0,8.49-3.51l12-12a12,12,0,0,0-17-17l-12,12A12,12,0,0,0,196,72Zm8.49,115.51a12,12,0,0,0-17,17l12,12a12,12,0,0,0,17-17ZM48,128a12,12,0,0,0-12-12H20a12,12,0,0,0,0,24H36A12,12,0,0,0,48,128Zm80,80a12,12,0,0,0-12,12v16a12,12,0,0,0,24,0V220A12,12,0,0,0,128,208Zm108-92H220a12,12,0,0,0,0,24h16a12,12,0,0,0,0-24Z"></path></svg>'}var bs=localStorage.getItem("theme");bs==="light"?(document.body.classList.add("light"),Ft(!0)):Ft(!1);function xs(t,e){let n;return function(...s){let i=()=>{clearTimeout(n),t(...s)};clearTimeout(n),n=setTimeout(i,e)}}var J="json";function Oe(t){if(t.qty!==void 0)return typeof t.qty=="number"?{value:t.qty,text:String(t.qty)}:t.qty;if(t.quantity)return t.quantity}function et(t){return t?t.type==="range"&&t.text||t.text?t.text:t.value!==void 0?t.value:t:""}function Ee(t){if(!t)return"0m";let e=Math.floor(t/60),n=t%60;return e>0?`${e}h ${n>0?n+"m":""}`:`${n}m`}function _s(t){let e=t.registry||{ingredients:{},cookware:{}},n="";if(t.title&&(n+=`# ${t.title}

`),t.meta&&Object.keys(t.meta).length>0||t.metrics){if(n+=`> **Metadata**
`,t.metrics&&(n+=`> - **Total Time**: ${Ee(t.metrics.totalTime)}
`,n+=`> - **Active Time**: ${Ee(t.metrics.activeTime)}
`,t.metrics.preparationTime&&(n+=`> - **Mise en place**: ${Ee(t.metrics.preparationTime)} (est.)
`)),t.meta)for(let[r,s]of Object.entries(t.meta))r!=="title"&&(n+=`> - ${r}: ${s}
`);n+=`
`}return t.shopping_list&&t.shopping_list.length>0&&(n+=`## \u{1F6D2} Shopping List

`,t.shopping_list.forEach(r=>{if(r.type==="alternative"||r.type==="group")n+=`- **Alternative Group**:
`,r.options.forEach(s=>{n+=`  - ${re(s,e)}
`});else if(r.type==="composite"){let s=re(r,e);n+=`- **${s}** (Composite):
`,r.usage.forEach(i=>{n+=`  - ${re(i,e)}
`})}else r.display?n+=`- ${r.display}
`:n+=`- ${re(r,e)}
`}),n+=`
`),t.cookware&&t.cookware.length>0&&(n+=`## \u{1F373} Cookware

`,t.cookware.forEach(r=>{r.type==="alternative"||r.type==="group"?(n+=`- **Alternative Group**:
`,r.options.forEach(s=>{n+=`  - ${Se(s,e)}
`})):n+=`- ${Se(r,e)}
`}),n+=`
`),t.sections&&t.sections.length>0&&(n+=`## \u{1F468}\u200D\u{1F373} Instructions

`,t.sections.forEach(r=>{r.title&&(n+=`### ${r.title}`,r.retro_planning&&(n+=` {T-${r.retro_planning}}`),n+=`

`),r.ingredients&&r.ingredients.length>0&&(n+=`**Ingredients**:
`,r.ingredients.forEach(s=>{s.type==="alternative"||s.type==="group"?(n+=`- **Alternative Group**:
`,s.options.forEach(i=>{n+=`  - ${re(i,e)}
`})):n+=`- ${re(s,e)}
`}),n+=`
`),r.steps.forEach((s,i)=>{if(s.type==="comment"){n+=`> *${s.value?s.value.trim():""}*

`;return}let a=i+1,l="";s.action&&(l+=`**[${s.action}]** `),s.type==="text"?l+=s.value:s.type==="step"&&(l+=s.content.map((o,d,c)=>{let u="";if(typeof o=="string")u=o;else if(o.type==="text")u=o.value;else if(o.type==="timer"){let h=`${et(o.quantity)}${o.unit?" "+o.unit:""}`;o.isAsync?u=`\u23F3 ${h} (async)`:u=`\u23F2\uFE0F ${h}`}else if(o.type==="temperature")u=`\u{1F525}${et(o.quantity)}${o.unit?" "+o.unit:""}`;else if(o.type==="reference"){u=`\u{1F449}*${e.ingredients[o.id]?.name||o.id}*`;let f=Oe(o);f&&(u+=` (${f.text||f.value}`,o.unit&&(u+=` ${o.unit}`),u+=")")}else!o.type&&o.id?e.cookware[o.id]?u=`*${Se(o,e)}*`:u=`**${re(o,e)}**`:o.type==="ingredient"?u=`**${re(o,e)}**`:o.type==="cookware"?u=`*${Se(o,e)}*`:o.type==="alternative"?u=o.options.map(h=>h.type==="cookware"||e.cookware[h.id]?`*${Se(h,e)}*`:`**${re(h,e)}**`).join(" or "):o.type==="group"?u=o.options.map(h=>h.type==="cookware"||e.cookware[h.id]?`*${Se(h,e)}*`:`**${re(h,e)}**`).join(" or "):o.type==="comment"&&(u=` *${o.value.trim()}*`);if(typeof o!="string"&&o.type!=="text"&&o.type!=="comment"){let h=c[d+1];if(h){let f="";typeof h=="string"?f=h[0]:h.type==="text"&&(f=h.value?h.value[0]:""),f&&/^[.,!?:;)]/.test(f)||f&&/^\s/.test(f)||(u+=" ")}}return u}).join("")),n+=`${a}. ${l}
`}),n+=`
`})),n}function re(t,e){let n=e.ingredients[t.id],r=n?n.name:t.id;t.alias&&(r=t.alias);let s=Oe(t),i=t.formula?`${t.formula.percent}% of ${t.formula.target}`:null;if(t.formula&&t.formula.is_partial)r+=` (${i} \u26A0\uFE0F)`;else{let l=[];if(s){let o=s.text||s.value;t.unit&&(o+=` ${t.unit}`),l.push(o)}t.variable_entries&&t.variable_entries.length>0&&l.push(...t.variable_entries),l.length>0&&(r+=` (${l.join(" + ")})`),i&&(r+=` [${i}]`)}return t.preparation&&(r+=` (${t.preparation})`),t.modifiers&&t.modifiers.includes("optional")&&(r+=" (optional)"),r}function Se(t,e){let n=e.cookware[t.id],r=n?n.name:t.id;t.alias&&(r=t.alias);let s=Oe(t);return s&&(r+=` (${s.value})`),r}function tt(){let t=se.value;try{let e=(0,Mn.getAST)(t),n=(0,Fn.compile)(e),r="";J==="json"?(r=JSON.stringify(n,null,2),n.warnings&&n.warnings.length>0?Xe(n.warnings):Pe()):J==="ast"?(r=Dt(e),Pe()):J==="markdown"?(r=_s(n),n.warnings&&n.warnings.length>0?Xe(n.warnings):Pe()):J==="json-tree"?(r=ws(n),n.warnings&&n.warnings.length>0?Xe(n.warnings):Pe()):J==="preview"&&(r=Ss(n),n.warnings&&n.warnings.length>0?Xe(n.warnings):Pe());let s=document.getElementById("preview-output"),i=document.getElementById("output").parentElement;if(J==="preview"||J==="json-tree"){if(i.style.display="none",s.style.display="block",s.innerHTML=r,J==="json-tree"){let a=s.querySelector("#btn-expand-all"),l=s.querySelector("#btn-collapse-all");a&&l&&(a.addEventListener("click",()=>{s.querySelectorAll(".json-node").forEach(c=>{c.classList.remove("collapsed");let u=c.querySelector(".json-toggle");u&&(u.textContent="\u25BC")})}),l.addEventListener("click",()=>{s.querySelectorAll(".json-node").forEach((c,u)=>{if(u===0)return;c.classList.add("collapsed");let p=c.querySelector(".json-toggle");p&&(p.textContent="\u25B6")})})),s.querySelectorAll(".json-header").forEach(d=>{d.addEventListener("click",c=>{c.stopPropagation();let u=d.parentElement;u.classList.toggle("collapsed");let p=d.querySelector(".json-toggle");p&&(u.classList.contains("collapsed")?p.textContent="\u25B6":p.textContent="\u25BC")})})}}else i.style.display="block",i.style.removeProperty("display"),s.style.display="none",J==="json"?(Z.textContent=r,Z.className="language-json"):J==="ast"?(Z.textContent=r,Z.className="language-lisp"):(Z.textContent=r,Z.className="language-markdown"),Z.removeAttribute("data-highlighted"),hljs.highlightElement(Z),hljs.lineNumbersBlock(Z);Ye.textContent="Valid",Ye.className="status success"}catch(e){Z.textContent=e.message,Z.textContent=e.message,Ye.textContent="Error",Ye.className="status error"}}function Ss(t){let e=t.registry||{ingredients:{},cookware:{}},n="";if(t.title&&(n+=`<h1>${A(t.title)}</h1>

`),n+=`<div class="recipe-meta">
`,t.metrics&&(n+=` <div class="meta-item">
`,n+=`   <div class="meta-icon">\u23F1\uFE0F</div>
`,n+=`   <div class="meta-content">
`,n+=`     <span class="meta-label">Total Time</span>
`,n+=`     <span class="meta-value">${Ee(t.metrics.totalTime)}</span>
`,n+=`   </div>
`,n+=` </div>
`,n+=` <div class="meta-item">
`,n+=`   <div class="meta-icon">\u{1F525}</div>
`,n+=`   <div class="meta-content">
`,n+=`     <span class="meta-label">Active Time</span>
`,n+=`     <span class="meta-value">${Ee(t.metrics.activeTime)}</span>
`,n+=`   </div>
`,n+=` </div>
`,n+=` <div class="meta-item" title="Based on ingredient count and complexity">
`,n+=`   <div class="meta-icon">\u{1F52A}</div>
`,n+=`   <div class="meta-content">
`,n+=`     <span class="meta-label">Prep Time</span>
`,n+=`     <span class="meta-value">${Ee(t.metrics.preparationTime)} <span class="est">(est.)</span></span>
`,n+=`   </div>
`,n+=` </div>
`),n+=`</div>
`,n+=`<div class="recipe-meta-secondary">
`,n+=`<div class="metadata-grid">
`,t.metrics&&t.metrics.totalMass){let r=Math.round(t.metrics.totalMass),s=`${r}g`,i="Total Recipe Input Mass";t.metrics.massStatus==="estimated"&&(s=`~${r}g`,i+=" (Estimated)"),t.metrics.massStatus==="incomplete"&&(s=`${r}g?`,i+=" (Incomplete)"),n+=`  <div class="meta-secondary-item" title="${i}">
`,n+=`    <span class="label">Total Mass</span>
`,n+=`    <span class="value">${s}</span>
`,n+=`  </div>
`}if(t.meta)for(let[r,s]of Object.entries(t.meta))r!=="title"&&(n+=`  <div class="meta-secondary-item">
`,n+=`    <span class="label">${A(r)}</span>
`,n+=`    <span class="value">${A(s)}</span>
`,n+=`  </div>
`);if(n+=`</div>
`,n+=`</div>

`,t.shopping_list&&t.shopping_list.length>0&&(n+=`<div class="shopping-list">
`,n+=`  <h2>Shopping List</h2>
`,n+=`  <ul>
`,t.shopping_list.forEach(r=>{if(r.type==="alternative"||r.type==="group")n+=`    <li>
`,n+=`      <strong>Alternative Group</strong>:
`,n+=`      <ul>
`,r.options.forEach(s=>{n+=`        <li>${oe(s,e)}</li>
`}),n+=`      </ul>
`,n+=`    </li>
`;else if(r.type==="composite")n+=`    <li>
`,n+=`      <strong>${oe(r,e)}</strong> (Composite):
`,n+=`      <ul>
`,r.usage.forEach(s=>{n+=`        <li>${oe(s,e)}</li>
`}),n+=`      </ul>
`,n+=`    </li>
`;else if(r.display)n+=`    <li>${A(r.display)}</li>
`;else{let s="";r.purchasingMass&&r.purchasingMass!==r.normalizedMass&&(s=` <span class="gross-mass" title="Purchasing Weight (including waste/peel)">(${Math.round(r.purchasingMass*10)/10}g gross)</span>`),n+=`    <li>${oe(r,e)}${s}</li>
`}}),n+=`  </ul>
`,n+=`</div>

`),t.cookware&&t.cookware.length>0&&(n+=`<div class="cookware">
`,n+=`  <h2>Cookware</h2>
`,n+=`  <ul>
`,t.cookware.forEach(r=>{r.type==="alternative"||r.type==="group"?(n+=`    <li>
`,n+=`      <strong>Alternative Group</strong>:
`,n+=`      <ul>
`,r.options.forEach(s=>{n+=`        <li>${ke(s,e)}</li>
`}),n+=`      </ul>
`,n+=`    </li>
`):n+=`    <li>${ke(r,e)}</li>
`}),n+=`  </ul>
`,n+=`</div>

`),t.sections&&t.sections.length>0&&(n+=`<div class="instructions">
`,t.sections.forEach(r=>{if(n+=`  <section>
`,r.title){let s=A(r.title);if(r.retro_planning&&(s+=` <small style="font-size:0.6em;opacity:0.8;border:1px solid currentColor;border-radius:4px;padding:2px 6px;vertical-align:middle;">\u23F1 ${A(r.retro_planning)}</small>`),r.metrics&&r.metrics.totalMass>0){let i=Math.round(r.metrics.totalMass),a=`${i}g`,l="Section Input Mass";r.metrics.massStatus==="estimated"&&(a=`~${i}g`,l+=" (Estimated)"),r.metrics.massStatus==="incomplete"&&(a=`${i}g?`,l+=" (Incomplete)"),s+=` <small style="font-size:0.6em;opacity:0.8;border:1px solid currentColor;border-radius:4px;padding:2px 6px;vertical-align:middle;" title="${l}">\u2696\uFE0F ${a}</small>`}n+=`    <h3>${s}</h3>
`}r.ingredients&&r.ingredients.length>0&&(n+=`    <div class="section-ingredients">
`,n+=`      <h4>Ingredients</h4>
`,n+=`      <ul>
`,r.ingredients.forEach(s=>{s.type==="alternative"||s.type==="group"?(n+=`        <li>
`,n+=`          <strong>Alternative Group</strong>:
`,n+=`          <ul>
`,s.options.forEach(i=>{n+=`            <li>${oe(i,e)}</li>
`}),n+=`          </ul>
`,n+=`        </li>
`):n+=`        <li>${oe(s,e)}</li>
`}),n+=`      </ul>
`,n+=`    </div>
`),n+=`    <ol class="steps">
`,r.steps.forEach((s,i)=>{if(s.type==="comment"){n+=`      <li style="list-style: none; margin-left: -1em; color: gray; font-style: italic;">
`,n+=`        ${A(s.value)}
`,n+=`      </li>
`;return}n+=`      <li>
`,s.action&&(n+=`        <span class="action">[${A(s.action)}]</span> `);let a="";s.type==="text"?a=A(s.value):s.type==="step"&&(a=s.content.map((l,o,d)=>{let c="";if(typeof l=="string")c=A(l);else if(l.type==="text")c=A(l.value);else if(l.type==="timer"){let p=l.quantity||{value:""},h=et(p);c=`<span class="timer${l.isAsync?" async":""}" data-value="${p.value}" data-unit="${l.unit||""}">${h}${l.unit?" "+l.unit:""}</span>`}else if(l.type==="temperature"){let p=l.quantity||{value:""},h=et(p);c=`<span class="temp" data-value="${p.value}" data-unit="${l.unit||""}">${h}${l.unit?" "+l.unit:""}</span>`}else if(l.type==="reference"){let p=e.ingredients[l.id]?.name||l.id,h=`<span class="reference">${A(p)}`,f=Oe(l);f&&(h+=` <span class="quantity">${f.text||f.value}`,l.unit&&(h+=` <span class="unit">${l.unit}</span>`),h+="</span>"),h+="</span>",c=h}else!l.type&&l.id?e.cookware[l.id]?c=ke(l,e):c=oe(l,e):l.type==="ingredient"?c=oe(l,e):l.type==="cookware"?c=ke(l,e):l.type==="alternative"||l.type==="group"?c=l.options.map(p=>p.type==="cookware"||e.cookware[p.id]?ke(p,e):oe(p,e)).join(' <span class="keyword">or</span> '):l.type==="comment"&&(c=`<!-- ${A(l.value.trim())} -->`);if(typeof l!="string"&&l.type!=="text"&&l.type!=="comment"){let p=d[o+1];if(p){let h="";typeof p=="string"?h=p[0]:p.type==="text"&&(h=p.value?p.value[0]:""),h&&/^[.,!?:;)]/.test(h)||h&&/^\s/.test(h)||(c+=" ")}}return c}).join("")),n+=`        ${a}
`,n+=`      </li>
`}),n+=`    </ol>
`,n+=`  </section>
`}),n+=`</div>
`),t.metrics&&t.metrics.nutrition&&t.metrics.nutrition.total&&t.metrics.nutrition.total.calories>0){let r=t.metrics.nutrition,s=r.total,i="",a=null;r.perPortion&&(i=" (Per Portion)",a=r.perPortion);let l=a||s,o=Math.round(l.calories),d=l.protein,c=l.carbs,u=l.fat,p=l.sugar!==void 0?l.sugar:"-",h=l.fiber!==void 0?l.fiber:"-",f=l.salt!==void 0?l.salt:"-";n+=`<div class="nutrition-panel">
`,n+=`  <div class="nut-header">Nutrition <span class="est-badge" title="Coverage: ${Math.round(r.coverage*100)}%">Estimate</span>${i}</div>
`,n+=`  <div class="nut-grid">
`,n+=`    <div class="nut-item"><strong>${o}</strong> <small>kcal</small></div>
`,n+=`    <div class="nut-item"><span class="label">Protein</span> <strong>${d}g</strong></div>
`,n+=`    <div class="nut-item"><span class="label">Carbs</span> <strong>${c}g</strong><small style="font-size:0.6em; opacity:0.8; margin-top:2px;">(sugar: ${p}g)</small></div>
`,n+=`    <div class="nut-item"><span class="label">Fat</span> <strong>${u}g</strong></div>
`,n+=`    <div class="nut-item"><span class="label">Fiber</span> <strong>${h}g</strong></div>
`,n+=`    <div class="nut-item"><span class="label">Salt</span> <strong>${f}g</strong></div>
`,n+=`  </div>
`,n+=`</div>
`}return n}function ws(t){let e=`<div class="json-controls">
        <button id="btn-expand-all" class="tree-btn">Expand All</button>
        <button id="btn-collapse-all" class="tree-btn">Collapse All</button>
    </div>`;return e+=`<div class="json-tree">${qn(t,null,!1)}</div>`,e}function qn(t,e=null,n=!1){let r=n?'<span class="json-comma">,</span>':"",s=e?`<span class="json-key">"${A(e)}"</span>: `:"";if(t===null||typeof t!="object"){let h="";t===null&&(h='<span class="json-null">null</span>'),typeof t=="boolean"&&(h=`<span class="json-bool">${t}</span>`),typeof t=="number"&&(h=`<span class="json-num">${t}</span>`),typeof t=="string"&&(h=`<span class="json-str">"${A(t)}"</span>`);let f=`${s}${h}${r}`;return`<div class="${e?"json-prop":"json-item"}">${f}</div>`}let i=Array.isArray(t),a=i?t:Object.keys(t),l=a.length===0,o=i?"[":"{",d=i?"]":"}",c=i?"json-bracket":"json-brace",u=`${a.length} items`;if(l)return`<div class="${e?"json-prop":"json-item"}">${s}<span class="${c}">${o}${d}</span>${r}</div>`;let p='<div class="json-node expanded">';return p+='<div class="json-header">',p+='<span class="json-toggle">\u25BC</span>',p+=s,p+=`<span class="${c}">${o}</span>`,p+=`<span class="json-count">${u}</span>`,p+="</div>",p+='<div class="json-children">',a.forEach((h,f)=>{let m=i?h:t[h];p+=qn(m,i?null:h,f<a.length-1)}),p+="</div>",p+=`<div class="json-footer"><span class="${c}">${d}</span>${r}</div>`,p+="</div>",p}function A(t){return t==null?"":String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function oe(t,e){let n=e.ingredients[t.id],r=n?n.name:t.id,s=r;t.alias&&(s=t.alias);let i=`<span class="ingredient" data-name="${A(r)}">${A(s)}`,a=Oe(t),l=t.formula?`${t.formula.percent}% of ${A(t.formula.target)}`:null;if(t.formula&&t.formula.is_partial)i+=` <span class="quantity formula-qty" title="Calculation partial or failed">(${l} \u26A0\uFE0F)</span>`;else{let d="";if(a&&(d+=a.text||a.value,t.unit&&(d+=` <span class="unit">${A(t.unit)}</span>`)),t.variable_entries&&t.variable_entries.length>0){let c=t.variable_entries.join(" + ");d?d+=` + ${c}`:d=c}d&&(i+=` <span class="quantity">(${d})</span>`),l&&(i+=` <span class="formula" title="Base Mass Used: ${t.formula?t.formula.base_mass_used:""}g">[${l}]</span>`)}if(t.normalizedMass){let d=Math.round(t.normalizedMass*10)/10,c=`${d}g`,u=`Calculated Mass: ${d}g
Method: ${t.conversionMethod}`;t.isEstimate&&(c=`~${c}`,u+=" (Estimated)"),t.conversionMethod==="explicit"?(c=`\u270D\uFE0F ${c}`,u+=" (User Override)"):t.conversionMethod==="physical"&&(u+=" (Exact)"),i+=` <span class="mass-badge" title="${u}">${c}</span>`}return t.preparation&&(i+=` <span class="prep">(${A(t.preparation)})</span>`),t.modifiers&&t.modifiers.includes("optional")&&(i+=' <span class="opt">(optional)</span>'),t.modifiers&&t.modifiers.includes("reference")&&(i+=' <span class="ref" title="Reference to existing ingredient">\u21A9\uFE0F</span>'),i+="</span>",i}function Dt(t,e=0){if(t==null)return"nil";if(typeof t!="object")return typeof t=="string"?`"${t}"`:String(t);if(Array.isArray(t))return t.map(o=>Dt(o,e)).join(`
`);let n="  ".repeat(e),r=t.type||"Object",s="",i=[],a=new Set(["type","loc"]);if(Object.entries(t).forEach(([o,d])=>{a.has(o)||d!==null&&(typeof d!="object"?s+=` :${o} ${typeof d=="string"?`"${d}"`:d}`:Array.isArray(d)?d.forEach(c=>i.push(c)):d.min!==void 0&&d.max!==void 0?s+=` :${o} ${d.min}-${d.max}`:i.push(d))}),i.length===0)return`${n}(${r}${s})`;let l=i.map(o=>Dt(o,e+1)).join(`
`);return`${n}(${r}${s}
${l})`}function ke(t,e){let n=e.cookware[t.id],r=n?n.name:t.id,s=r;t.alias&&(s=t.alias);let i=`<span class="cookware" data-name="${A(r)}">${A(s)}`,a=Oe(t);return a&&(i+=` <span class="quantity">(${a.value})</span>`),i+="</span>",i}var Me=document.getElementById("highlights");function jt(t){let e=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return e=e.replace(/(\/\/.*)/g,'<span class="token-comment">$1</span>'),t.split(`
`).map(s=>{let i=s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return i.trim().startsWith("//")?`<span class="token-comment">${i}</span>`:i.trim().startsWith("##")?`<span class="token-header">${i.replace(/(\{T-.*?\})/,'<span class="token-timer">$1</span>')}</span>`:i.trim()==="---"?`<span class="token-frontmatter">${i}</span>`:(i=i.replace(/^(\s*)(\[)([^\]]+)(\])/,'$1<span class="token-action">$2$3$4</span>'),i=i.replace(/(-&gt;&amp;|[@#~!&])((?:\[.*?\]|[^\{\[\<\(\|\@\#\~\!\n])*)(\{.*?\})?/g,(a,l,o,d)=>{if(l==="!"&&!d&&(!o||!o.trim().match(/[a-zA-Z0-9]/)))return a;let c=l,u=o;if(l==="&"){if(o==="lt;"||o==="gt;"||o==="amp;")return a;o.startsWith("amp;")&&(u=o.slice(4))}l==="-&gt;&amp;"&&(c="->&");let p="token-ingredient";l==="#"&&(p="token-cookware"),l==="~"&&(p="token-timer"),l==="!"&&(p="token-temp"),(l==="&"||l==="-&gt;&amp;")&&(p="token-decl");let h=`<span class="${p}">${c}</span>`,f=`<span class="${p}">${u}</span>`,m="";return d&&(m=`<span class="${p}">${d}</span>`,m=m.replace(/(\d+(?:\.\d+)?)/g,'<span class="token-qty">$1</span>'),m=m.replace(/(%)([\w]+)/g,'<span class="token-syntax">$1</span><span class="token-unit">$2</span>')),`${h}${f}${m}`}),i)}).join(`
`)+"<br>"}function As(){let t=se.value;Me.innerHTML=jt(t),tt()}function Es(){Me.scrollTop=se.scrollTop,Me.scrollLeft=se.scrollLeft}se.addEventListener("scroll",Es);se.addEventListener("input",()=>{Me.innerHTML=jt(se.value)});var Os=xs(tt,300);se.addEventListener("input",Os);Me.innerHTML=jt(se.value);tt();function Xe(t){if(!$e)return;$e.style.display="block";let e='<div style="color: #ef4444; font-weight: bold; margin-bottom: 0.5rem;">\u26A0\uFE0F Compiler Warnings</div>';e+='<ul style="margin: 0; padding-left: 1.5rem; color: #ef4444;">',t.forEach(n=>{e+=`<li>[${n.code}] ${n.message}</li>`}),e+="</ul>",$e.innerHTML=e}function Pe(){$e&&($e.style.display="none")}var we=document.getElementById("copy-btn");we.addEventListener("click",()=>{let t=Z.textContent;navigator.clipboard.writeText(t).then(()=>{let e=we.innerHTML;we.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256"><path d="M229.66,55.51a8,8,0,0,0-11.32,0L102.5,171.34,49.66,118.51a8,8,0,0,0-11.32,11.32l58.5,58.5a8,8,0,0,0,11.32,0L229.66,66.83A8,8,0,0,0,229.66,55.51Z"></path></svg>',we.style.color="var(--token-def)",setTimeout(()=>{we.innerHTML=e,we.style.color=""},2e3)}).catch(e=>{console.error("Failed to copy: ",e)})});var Ae=document.getElementById("examples-select");Ae&&(fetch("dist/examples/manifest.json").then(t=>{if(!t.ok)throw new Error("Could not load manifest");return t.json()}).then(t=>{if(Ae.options.length>1)for(;Ae.options.length>1;)Ae.remove(1);t.forEach(e=>{let n=document.createElement("option");n.value=e.id,n.dataset.path=e.path,n.textContent=e.title,Ae.appendChild(n)})}).catch(t=>console.error("Manifest Error:",t)),Ae.addEventListener("change",t=>{let e=t.target.selectedOptions[0];if(!e||!e.dataset.path)return;let n=e.dataset.path;fetch(n).then(r=>{if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return r.text()}).then(r=>{se.value=r,As()}).catch(r=>{console.error("Could not load example:",r),alert("Error loading example file.")}),t.target.value=""}));})();
//# sourceMappingURL=app.js.map
